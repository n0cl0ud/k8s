<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K8s Deployment Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: auto;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            padding-right: calc(35vw + 40px); /* Espace pour les onglets */
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #4CAF50, #45a049, #66BB6A);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .cluster-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .control-plane, .worker-nodes {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(76, 175, 80, 0.3);
        }
        
        .section-title {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #4CAF50;
        }
        
        .component {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #333;
            border-radius: 10px;
            margin: 15px 0;
            padding: 20px;
            transition: all 0.5s ease;
            position: relative;
        }
        
        .component.active {
            border-color: #4CAF50;
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.4);
            background: rgba(76, 175, 80, 0.1);
        }
        
        .component.processing {
            border-color: #FF9800;
            box-shadow: 0 0 25px rgba(255, 152, 0, 0.4);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.8; }
        }
        
        .component-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .component-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        
        .component-state {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            border-left: 4px solid #333;
            transition: all 0.3s ease;
        }
        
        .component-state.updated {
            border-left-color: #4CAF50;
            animation: glow 1s ease-in-out;
        }
        
        @keyframes glow {
            0% { background: #1a1a1a; }
            50% { background: rgba(76, 175, 80, 0.1); }
            100% { background: #1a1a1a; }
        }
        
        .etcd-data {
            color: #66BB6A;
        }
        
        .scheduler-decision {
            color: #FFEB3B;
        }
        
        .controller-action {
            color: #2196F3;
        }
        
        .kubelet-operation {
            color: #FF9800;
        }
        
        .proxy-rules {
            color: #9C27B0;
        }
        
        .dns-records {
            color: #00BCD4;
        }
        
        .timeline.fixed-timeline {
            position: fixed;
            top: 20px;
            right: 20px;
            width: min(380px, 25vw);
            max-height: 85vh;
            overflow-y: auto;
            overflow-x: hidden;
            background: rgba(0, 0, 0, 0.95);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid rgba(76, 175, 80, 0.3);
            z-index: 100;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: none;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .timeline h3 {
            color: #4CAF50;
            margin: 0;
            text-align: left;
        }
        
        .timeline-toggle {
            background: transparent;
            border: none;
            color: #4CAF50;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            padding: 5px;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .timeline-toggle:hover {
            color: #66BB6A;
            transform: rotate(180deg);
        }
        
        .timeline-toggle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border-radius: 4px;
            background: rgba(76, 175, 80, 0.1);
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: -1;
        }
        
        .timeline-toggle:hover::before {
            opacity: 1;
        }
        
        .timeline-content {
            transition: all 0.3s ease;
            overflow: hidden;
            max-height: 1000px;
        }
        
        .timeline-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .timeline-container .timeline.collapsed {
            transform: scale(0.9);
            opacity: 0.8;
            height: auto;
            min-height: 50px;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            border-radius: 15px;
            padding: 8px;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .timeline-container .timeline.collapsed .timeline-header {
            background: transparent;
            border-radius: 10px;
            padding: 5px 10px;
            margin: 0;
            pointer-events: auto;
        }

        .timeline-container .timeline.collapsed .timeline-content {
            display: none;
        }

        .timeline-container .timeline.collapsed:hover {
            opacity: 1;
            transform: scale(0.95);
            background: rgba(76, 175, 80, 0.3);
        }
        
        .timeline-step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin: 6px 0;
            border-left: 4px solid #666;
            transition: all 0.3s ease;
            font-size: 0.85em;
            line-height: 1.3;
            word-wrap: break-word;
        }
        
        .timeline-step.active {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
            transform: translateX(5px);
        }
        
        .timeline-step.completed {
            border-left-color: #2196F3;
            background: rgba(33, 150, 243, 0.1);
            opacity: 0.7;
        }
        
        .step-detail {
            font-size: 0.8em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .yaml-manifest {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #333;
            font-family: 'Courier New', monospace;
        }
        
        .yaml-title {
            color: #4CAF50;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        #yaml-content {
            color: #f8f8f2;
            font-size: 0.9em;
            line-height: 1.4;
            overflow-x: auto;
        }
        
        #yaml-content pre {
            margin: 0;
            padding: 0;
            font-family: inherit;
            white-space: pre;
            color: inherit;
            background: transparent;
            border: none;
            font-size: inherit;
            line-height: inherit;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            background: #666;
            transition: all 0.3s ease;
        }
        
        .status-indicator.pending {
            background: #FF9800;
            animation: blink 1s infinite;
        }
        
        .status-indicator.running {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.6);
        }
        
        .status-indicator.error {
            background: #F44336;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .data-flow {
            font-size: 0.8em;
            color: #888;
            margin: 5px 0;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 4px;
        }
        
        .highlight-new {
            background: rgba(76, 175, 80, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
            animation: highlight 2s ease-in-out;
        }
        
        @keyframes highlight {
            0% { background: rgba(76, 175, 80, 0.4); }
            100% { background: rgba(76, 175, 80, 0.1); }
        }
        
        .network-diagram {
            margin: 20px 0;
            text-align: center;
        }
        
        .pod-representation {
            display: inline-block;
            width: 80px;
            height: 50px;
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            border-radius: 25px;
            margin: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            text-align: center;
            transform: scale(0);
            transition: all 0.5s ease;
            border: 2px solid #2E7D32;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .pod-representation.visible {
            transform: scale(1);
            animation: spin 3s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        
        /* Configuration Panel Styles */
        .config-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }
        
        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .config-header h3 {
            color: #4CAF50;
            margin: 0;
            font-size: 1.3em;
        }
        
        .config-toggle {
            background: transparent;
            border: none;
            color: #4CAF50;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            padding: 5px;
            transition: all 0.2s ease;
        }
        
        .config-toggle:hover {
            color: #66BB6A;
            transform: rotate(180deg);
        }
        
        .config-content {
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .config-content.collapsed {
            max-height: 0;
            opacity: 0;
        }
        
        .config-section {
            margin-bottom: 20px;
        }
        
        .config-section h4 {
            color: #66BB6A;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-left: 3px solid #4CAF50;
            padding-left: 10px;
        }
        
        .config-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .config-option {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.02);
        }
        
        .config-option:hover {
            background: rgba(76, 175, 80, 0.1);
            transform: translateX(5px);
        }
        
        .config-option input[type="radio"] {
            margin-top: 2px;
            accent-color: #4CAF50;
        }
        
        .option-label {
            font-weight: bold;
            color: #fff;
            min-width: 150px;
        }
        
        .option-description {
            color: #ccc;
            font-size: 0.9em;
            flex: 1;
        }
        
        /* Responsive Design for Timeline */
        @media (max-width: 1200px) {
            .timeline {
                width: min(350px, 30vw);
                right: 10px;
                padding: 12px;
            }
            
            .timeline-step {
                padding: 8px;
                font-size: 0.8em;
            }
        }
        
        @media (max-width: 768px) {
            .timeline {
                position: relative;
                width: 100%;
                right: auto;
                top: auto;
                margin: 20px 0;
                max-height: 300px;
                z-index: 10;
            }
            
            .container {
                padding: 10px;
            }
            
            .timeline h3 {
                font-size: 1.1em;
                margin: 0;
            }
            
            .timeline-header {
                margin-bottom: 10px;
            }
            
            .timeline-step {
                padding: 8px;
                margin: 4px 0;
                font-size: 0.8em;
            }
            
            .config-panel {
                padding: 15px;
                margin: 15px 0;
            }
            
            .config-options {
                gap: 6px;
            }
            
            .config-option {
                padding: 8px;
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .option-label {
                min-width: auto;
                font-size: 0.9em;
            }
            
            .option-description {
                font-size: 0.8em;
                margin-left: 0;
            }
        }
        
        @media (max-width: 480px) {
            .timeline {
                padding: 10px;
                border-radius: 10px;
            }
            
            .timeline-step {
                padding: 6px;
                font-size: 0.75em;
            }
        }

        /* Integrated Terminal Tabs */
        .terminal-tabs {
            position: fixed;
            top: 20px;
            right: 20px;
            width: min(450px, 35vw);
            height: 75vh;
            max-height: 600px;
            background: rgba(10, 10, 10, 0.95);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            backdrop-filter: blur(20px);
            z-index: 200;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .tab-headers {
            display: flex;
            background: rgba(76, 175, 80, 0.1);
            border-bottom: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 15px 15px 0 0;
        }

        .tab-header {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            color: #888;
            font-size: 0.85em;
            font-weight: bold;
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
            user-select: none;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            position: relative;
            z-index: 10;
        }

        .tab-header.active {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
            border-bottom-color: #4CAF50;
        }

        .tab-header:hover {
            color: #66BB6A;
            background: rgba(76, 175, 80, 0.05);
        }

        .tab-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .tab-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 15px;
            overflow-y: auto;
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* kubectl Terminal Panel */
        .kubectl-panel {
            background: #0a0a0a;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .kubectl-content {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .shell-output {
            color: #e0e0e0;
            font-size: 0.85em;
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 10px;
        }

        .shell-prompt {
            display: flex;
            align-items: center;
            margin-top: 10px;
            position: sticky;
            bottom: 0;
            background: #0a0a0a;
            padding: 5px 0;
        }

        .prompt-symbol {
            color: #4CAF50;
            margin-right: 8px;
            font-weight: bold;
        }

        .shell-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #ffffff;
            font-family: inherit;
            font-size: 0.85em;
            outline: none;
        }

        .shell-input::placeholder {
            color: #666;
        }

        .kubectl-output {
            margin: 5px 0;
        }

        .kubectl-header {
            color: #4CAF50;
            font-weight: bold;
            border-bottom: 1px solid #333;
            padding-bottom: 2px;
            margin-bottom: 5px;
        }

        .kubectl-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            padding: 2px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .kubectl-row:nth-child(even) {
            background: rgba(255,255,255,0.02);
        }

        .status-running { color: #4CAF50; }
        .status-pending { color: #FF9800; }
        .status-error { color: #F44336; }
        .status-terminating { color: #FF5722; }

        .resource-name { color: #64B5F6; }
        .namespace-name { color: #FFB74D; }

        .autocomplete-suggestions {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid #4CAF50;
            border-radius: 5px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 10;
        }

        .autocomplete-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.8em;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: rgba(76, 175, 80, 0.2);
        }

        .command-history {
            color: #888;
            font-style: italic;
        }

        .yaml-output {
            color: #81C784;
            background: rgba(255,255,255,0.02);
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            border-left: 3px solid #4CAF50;
        }

        .json-output {
            color: #FFD54F;
            background: rgba(255,255,255,0.02);
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            border-left: 3px solid #FFC107;
        }

        .error-output {
            color: #FF5252;
            background: rgba(244, 67, 54, 0.1);
            padding: 8px;
            border-radius: 5px;
            border-left: 3px solid #F44336;
        }

        /* Terminal Tabs Styles */
        .terminal-tabs {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid #333;
        }

        .tab-headers {
            display: flex;
            background: #2d2d2d;
            border-bottom: 1px solid #444;
        }

        .tab-header {
            flex: 1;
            padding: 12px 20px;
            cursor: pointer;
            border-right: 1px solid #444;
            background: #2d2d2d;
            color: #ccc;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            position: relative;
        }

        .tab-header:last-child {
            border-right: none;
        }

        .tab-header:hover {
            background: #3d3d3d;
            color: #fff;
        }

        .tab-header.active {
            background: #1e1e1e;
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
        }

        .tab-icon {
            font-size: 16px;
        }

        .tab-badge {
            background: #FF5722;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            min-width: 16px;
            text-align: center;
            display: none;
        }

        .tab-badge.show {
            display: block;
        }

        .tab-panels {
            flex: 1;
            height: auto;
            max-height: calc(75vh - 80px);
            overflow: hidden;
        }

        .tab-panel {
            height: 100%;
            display: none;
            background: #1e1e1e;
        }

        .tab-panel.active {
            display: block;
        }

        /* Timeline specific styles */
        .timeline-container {
            height: 100%;
            overflow-y: auto;
            padding: 15px;
        }

        .timeline {
            background: transparent;
        }

        .timeline-step {
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 6px;
            background: rgba(255,255,255,0.05);
            border-left: 3px solid #666;
            transition: all 0.3s ease;
        }

        .timeline-step.active {
            background: rgba(76, 175, 80, 0.1);
            border-left-color: #4CAF50;
            transform: translateX(5px);
        }

        .timeline-step.completed {
            background: rgba(76, 175, 80, 0.05);
            border-left-color: #4CAF50;
            opacity: 0.7;
        }

        .step-detail {
            color: #ccc;
            font-size: 0.9em;
            margin-top: 4px;
            font-weight: normal;
        }

        /* kubectl Terminal styles */
        .kubectl-terminal {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .terminal-header {
            background: #2d2d2d;
            padding: 10px 15px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-title {
            color: #4CAF50;
            font-weight: bold;
        }

        .terminal-controls {
            display: flex;
            gap: 8px;
        }

        .terminal-btn {
            background: #333;
            color: #ccc;
            border: 1px solid #555;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s ease;
        }

        .terminal-btn:hover {
            background: #444;
            color: #fff;
        }

        .terminal-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .terminal-output {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.4;
            background: #1e1e1e;
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
            background: #2d2d2d;
            padding: 10px 15px;
            border-top: 1px solid #444;
            position: relative;
        }

        .terminal-prompt {
            color: #4CAF50;
            font-family: 'Consolas', 'Monaco', monospace;
            font-weight: bold;
            margin-right: 8px;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            outline: none;
        }

        .terminal-input::placeholder {
            color: #666;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #2d2d2d;
            border: 1px solid #444;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
        }

        .autocomplete-item {
            padding: 8px 15px;
            color: #fff;
            cursor: pointer;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: #0066cc;
        }

        /* Logs styles */
        .logs-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .logs-header {
            background: #2d2d2d;
            padding: 10px 15px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logs-title {
            color: #2196F3;
            font-weight: bold;
        }

        .logs-controls {
            display: flex;
            gap: 8px;
        }

        .logs-output {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.4;
            background: #1e1e1e;
            color: #ccc;
        }

        .log-entry {
            margin-bottom: 2px;
            padding: 2px 0;
        }

        .log-timestamp {
            color: #666;
            margin-right: 8px;
        }

        .log-level-info {
            color: #2196F3;
        }

        .log-level-warn {
            color: #FF9800;
        }

        .log-level-error {
            color: #F44336;
        }

        .log-level-success {
            color: #4CAF50;
        }

        /* Terminal fullscreen mode */
        .terminal-tabs.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            border-radius: 0;
            border: none;
        }

        .terminal-tabs.fullscreen .tab-panels {
            height: calc(100vh - 60px);
        }

        /* Terminal tabs minimized mode */
        .terminal-tabs.minimized {
            width: auto;
            height: auto;
            min-width: 200px;
            max-width: 300px;
            min-height: 60px;
            max-height: 80px;
            background: rgba(76, 175, 80, 0.2);
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .terminal-tabs.minimized:hover {
            transform: scale(0.85);
            background: rgba(76, 175, 80, 0.3);
        }

        .terminal-tabs.minimized .tab-panels {
            display: none;
        }

        .terminal-tabs.minimized .tab-headers {
            padding: 5px;
            border-radius: 15px;
            background: rgba(76, 175, 80, 0.3);
        }

        .terminal-tabs.minimized .tab-header {
            padding: 8px 12px;
            font-size: 0.9em;
            min-height: 35px;
            border-radius: 10px;
            margin: 2px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.4);
        }

        .terminal-tabs.minimized .tab-header.active {
            background: rgba(76, 175, 80, 0.4);
            color: #fff;
            border-color: #4CAF50;
        }

        .terminal-tabs.minimized .tab-header:hover {
            background: rgba(76, 175, 80, 0.3);
            color: #fff;
            transform: scale(1.05);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .terminal-tabs {
                margin: 10px 0;
            }

            .tab-panels {
                height: 400px;
            }

            .tab-header {
                padding: 10px 12px;
                font-size: 14px;
            }

            .tab-header span:not(.tab-icon) {
                display: none;
            }

            .tab-header .tab-icon {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 Kubernetes Deployment Simulator</h1>
        <p style="text-align: center; opacity: 0.8; margin-bottom: 20px;">
            Step-by-step visualization of all components in action
        </p>
        
        <!-- Configuration Panel -->
        <div class="config-panel">
            <div class="config-header">
                <h3>⚙️ Cluster Configuration</h3>
                <button class="config-toggle" onclick="toggleConfig()">▼</button>
            </div>
            <div class="config-content">
                <div class="config-section">
                    <h4>🌐 Network Proxy</h4>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="network-proxy" value="kube-proxy" checked onclick="updateNetworkProxy('kube-proxy')">
                            <span class="option-label">kube-proxy (iptables)</span>
                            <span class="option-description">Standard Kubernetes networking</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="network-proxy" value="cilium" onclick="updateNetworkProxy('cilium')">
                            <span class="option-label">Cilium (eBPF)</span>
                            <span class="option-description">Advanced eBPF-based networking with observability</span>
                        </label>
                    </div>
                </div>
                
                <div class="config-section">
                    <h4>🚪 Ingress Controller</h4>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="ingress" value="none" checked onclick="updateIngress('none')">
                            <span class="option-label">None</span>
                            <span class="option-description">Direct service access only</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="ingress" value="nginx" onclick="updateIngress('nginx')">
                            <span class="option-label">NGINX Ingress</span>
                            <span class="option-description">Popular HTTP/HTTPS ingress controller</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="ingress" value="traefik" onclick="updateIngress('traefik')">
                            <span class="option-label">Traefik</span>
                            <span class="option-description">Modern ingress with automatic service discovery</span>
                        </label>
                    </div>
                </div>
                
                <div class="config-section">
                    <h4>🔍 DNS Configuration</h4>
                    <div class="config-options">
                        <label class="config-option">
                            <input type="radio" name="dns" value="coredns" checked onclick="updateDNS('coredns')">
                            <span class="option-label">CoreDNS</span>
                            <span class="option-description">Standard Kubernetes DNS server</span>
                        </label>
                        <label class="config-option">
                            <input type="radio" name="dns" value="coredns-custom" onclick="updateDNS('coredns-custom')">
                            <span class="option-label">CoreDNS + External DNS</span>
                            <span class="option-description">With external DNS management</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="yaml-manifest">
            <div class="yaml-title">📝 Manifest to deploy:</div>
            <div id="yaml-content">
<pre>apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-deployment
  namespace: default
  labels:
    app: webapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: webapp
  template:
    metadata:
      labels:
        app: webapp
    spec:
      containers:
      - name: webapp
        image: nginx:1.21
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
---
apiVersion: v1
kind: Service
metadata:
  name: webapp-service
  labels:
    app: webapp
spec:
  selector:
    app: webapp
  ports:
  - name: http
    port: 80
    targetPort: 80
    protocol: TCP
  type: ClusterIP</pre>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="startDeployment()" id="playBtn">▶️ Play Deployment</button>
            <button onclick="pauseDeployment()" id="pauseBtn" disabled>⏸️ Pause</button>
            <button onclick="resetSimulation()" id="resetBtn">🔄 Reset</button>
            <button onclick="toggleSpeed()" id="speedBtn">⚡ Speed: 1x</button>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- Terminal Tabs Integration -->
        <div class="terminal-tabs">
            <div class="tab-headers">
                <div class="tab-header active" onclick="switchTab(event, 'timeline')">
                    <span class="tab-icon">⏱️</span>
                    <span>Timeline</span>
                    <span class="tab-badge" id="timeline-badge"></span>
                </div>
                <div class="tab-header" onclick="switchTab(event, 'kubectl')">
                    <span class="tab-icon">⚡</span>
                    <span>kubectl</span>
                    <span class="tab-badge" id="kubectl-badge"></span>
                </div>
                <div class="tab-header" onclick="switchTab(event, 'logs')">
                    <span class="tab-icon">📋</span>
                    <span>Logs</span>
                    <span class="tab-badge" id="logs-badge"></span>
                </div>
            </div>
            
            <div class="tab-panels">
                <!-- Timeline Panel -->
                <div class="tab-panel active" id="timeline-panel">
                    <div class="timeline-container">
                        <div class="timeline" id="timeline">
                            <div class="timeline-header">
                                <h3>📋 Deployment Timeline</h3>
                                <button class="timeline-toggle" onclick="toggleTimeline()">▼</button>
                            </div>
                            <div class="timeline-content" id="timeline-content">
                                <div class="timeline-step" id="step-1">
                                <strong>1. kubectl apply</strong>
                                <div class="step-detail">Sending YAML to API Server</div>
                            </div>
                            <div class="timeline-step" id="step-2">
                                <strong>2. API Validation</strong>
                                <div class="step-detail">Authentication + RBAC + Admission</div>
                            </div>
                            <div class="timeline-step" id="step-3">
                                <strong>3. etcd Storage</strong>
                                <div class="step-detail">Deployment & Service objects persisted</div>
                            </div>
                            <div class="timeline-step" id="step-4">
                                <strong>4. Controller Detection</strong>
                                <div class="step-detail">Deployment Controller creates ReplicaSet</div>
                            </div>
                            <div class="timeline-step" id="step-5">
                                <strong>5. ReplicaSet Creation</strong>
                                <div class="step-detail">3 Pod specs generated</div>
                            </div>
                            <div class="timeline-step" id="step-6">
                                <strong>6. Pod Scheduling</strong>
                                <div class="step-detail">Scheduler assigns pods to nodes</div>
                            </div>
                            <div class="timeline-step" id="step-7">
                                <strong>7. Kubelet Action</strong>
                                <div class="step-detail">Container creation on worker nodes</div>
                            </div>
                            <div class="timeline-step" id="step-8">
                                <strong>8. Image Pull</strong>
                                <div class="step-detail">nginx:1.21 downloaded</div>
                            </div>
                            <div class="timeline-step" id="step-9">
                                <strong>9. Container Start</strong>
                                <div class="step-detail">Pods transition to Running</div>
                            </div>
                            <div class="timeline-step" id="step-10">
                                <strong>10. Service Endpoints</strong>
                                <div class="step-detail">kube-proxy updates iptables</div>
                            </div>
                            <div class="timeline-step" id="step-11">
                                <strong>11. DNS Registration</strong>
                                <div class="step-detail">webapp-service.default.svc.cluster.local</div>
                            </div>
                            <div class="timeline-step" id="step-12">
                                <strong>12. Health Checks</strong>
                                <div class="step-detail">Readiness probes successful</div>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- kubectl Panel -->
                <div class="tab-panel" id="kubectl-panel">
                    <div class="kubectl-terminal">
                        <div class="terminal-header">
                            <span class="terminal-title">🔧 kubectl Terminal</span>
                            <div class="terminal-controls">
                                <button class="terminal-btn" onclick="clearTerminal()">Clear</button>
                                <button class="terminal-btn" onclick="toggleTerminalFullscreen()">⛶</button>
                            </div>
                        </div>
                        <div class="terminal-body">
                            <div class="terminal-output" id="terminalOutput"></div>
                            <div class="terminal-input-line">
                                <span class="terminal-prompt">kubectl&gt;</span>
                                <input type="text" 
                                       id="terminalInput" 
                                       class="terminal-input" 
                                       placeholder="Type kubectl commands... (try 'get pods' or 'help')"
                                       autocomplete="off"
                                       onkeydown="handleTerminalInput(event)">
                                <div id="autocompleteSuggestions" class="autocomplete-suggestions" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Logs Panel -->
                <div class="tab-panel" id="logs-panel">
                    <div class="logs-container">
                        <div class="logs-header">
                            <span class="logs-title">📋 Live Cluster Logs</span>
                            <div class="logs-controls">
                                <button class="terminal-btn" onclick="clearLogs()">Clear</button>
                                <button class="terminal-btn" onclick="toggleAutoScroll()" id="autoScrollBtn">📍 Auto-scroll: ON</button>
                            </div>
                        </div>
                        <div class="logs-output" id="logsOutput"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="cluster-view">
            <div class="control-plane">
                <div class="section-title">🏗️ Control Plane</div>
                
                <div class="component" id="api-server">
                    <div class="component-header">
                        <span class="component-icon">🌐</span>
                        <span>API Server</span>
                        <span class="status-indicator" id="api-status"></span>
                    </div>
                    <div class="component-state" id="api-state">
                        <div>🔒 Status: Waiting for requests...</div>
                        <div class="data-flow">HTTP Requests: 0</div>
                        <div class="data-flow">Authentication: Ready</div>
                        <div class="data-flow">Validation: Standby</div>
                    </div>
                </div>
                
                <div class="component" id="etcd">
                    <div class="component-header">
                        <span class="component-icon">🗄️</span>
                        <span>etcd Database</span>
                        <span class="status-indicator" id="etcd-status"></span>
                    </div>
                    <div class="component-state" id="etcd-state">
                        <div class="etcd-data">📊 Cluster State:</div>
                        <div class="data-flow">Keys: 0 deployment-related</div>
                        <div class="data-flow">Watchers: Active</div>
                        <div class="data-flow">Revision: 1000</div>
                    </div>
                </div>
                
                <div class="component" id="scheduler">
                    <div class="component-header">
                        <span class="component-icon">📋</span>
                        <span>Scheduler</span>
                        <span class="status-indicator" id="scheduler-status"></span>
                    </div>
                    <div class="component-state" id="scheduler-state">
                        <div class="scheduler-decision">🎯 Scheduling Queue:</div>
                        <div class="data-flow">Pending Pods: 0</div>
                        <div class="data-flow">Node Evaluation: Idle</div>
                        <div class="data-flow">Available Nodes: 3</div>
                    </div>
                </div>
                
                <div class="component" id="controller-manager">
                    <div class="component-header">
                        <span class="component-icon">🎮</span>
                        <span>Controller Manager</span>
                        <span class="status-indicator" id="controller-status"></span>
                    </div>
                    <div class="component-state" id="controller-state">
                        <div class="controller-action">🔄 Active Controllers:</div>
                        <div class="data-flow">Deployment Controller: Watching</div>
                        <div class="data-flow">ReplicaSet Controller: Idle</div>
                        <div class="data-flow">Endpoint Controller: Ready</div>
                    </div>
                </div>
            </div>
            
            <div class="worker-nodes">
                <div class="section-title">👷 Worker Nodes</div>
                
                <div class="component" id="kubelet">
                    <div class="component-header">
                        <span class="component-icon">🤖</span>
                        <span>Kubelet (node-1)</span>
                        <span class="status-indicator" id="kubelet-status"></span>
                    </div>
                    <div class="component-state" id="kubelet-state">
                        <div class="kubelet-operation">🛠️ Node Operations:</div>
                        <div class="data-flow">Assigned Pods: 0</div>
                        <div class="data-flow">Container Runtime: Ready</div>
                        <div class="data-flow">Image Cache: nginx:1.21 not cached</div>
                    </div>
                </div>
                
                <div class="component" id="kube-proxy">
                    <div class="component-header">
                        <span class="component-icon">🔀</span>
                        <span>kube-proxy</span>
                        <span class="status-indicator" id="proxy-status"></span>
                    </div>
                    <div class="component-state" id="proxy-state">
                        <div class="proxy-rules">🌐 Network Rules:</div>
                        <div class="data-flow">iptables chains: default</div>
                        <div class="data-flow">Service endpoints: 0</div>
                        <div class="data-flow">Load balancing: inactive</div>
                    </div>
                </div>
                
                <div class="component" id="dns">
                    <div class="component-header">
                        <span class="component-icon">🔍</span>
                        <span>CoreDNS</span>
                        <span class="status-indicator" id="dns-status"></span>
                    </div>
                    <div class="component-state" id="dns-state">
                        <div class="dns-records">📋 DNS Records:</div>
                        <div class="data-flow">A Records: default services only</div>
                        <div class="data-flow">Cache: Clean</div>
                        <div class="data-flow">Queries/sec: 0</div>
                    </div>
                </div>
                
                <div class="network-diagram">
                    <h4>🌐 Pod Network</h4>
                    <div id="pod-network">
                        <div class="pod-representation" id="pod-1">webapp-1</div>
                        <div class="pod-representation" id="pod-2">webapp-2</div>
                        <div class="pod-representation" id="pod-3">webapp-3</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Integrated Terminal Tabs -->  

    <script>
        console.log('Script starting...');
        let currentStep = 0;
        let isPlaying = false;
        let isPaused = false;
        let deploymentInterval;
        let speed = 1; // 1x, 2x, 4x
        let autoScroll = true;
        let terminalHistory = [];
        let historyIndex = -1;
        
        const steps = [
            {
                name: "kubectl apply",
                duration: 2000,
                execute: executeStep1
            },
            {
                name: "API Validation", 
                duration: 1500,
                execute: executeStep2
            },
            {
                name: "etcd Storage",
                duration: 1000,
                execute: executeStep3
            },
            {
                name: "Controller Detection",
                duration: 2000,
                execute: executeStep4
            },
            {
                name: "ReplicaSet Creation",
                duration: 1500,
                execute: executeStep5
            },
            {
                name: "Pod Scheduling",
                duration: 3000,
                execute: executeStep6
            },
            {
                name: "Kubelet Action",
                duration: 2000,
                execute: executeStep7
            },
            {
                name: "Image Pull",
                duration: 4000,
                execute: executeStep8
            },
            {
                name: "Container Start", 
                duration: 2000,
                execute: executeStep9
            },
            {
                name: "Service Endpoints",
                duration: 1500,
                execute: executeStep10
            },
            {
                name: "DNS Registration",
                duration: 1000,
                execute: executeStep11
            },
            {
                name: "Health Checks",
                duration: 2000,
                execute: executeStep12
            }
        ];
        
        function startDeployment() {
            console.log('startDeployment called');
            if (isPaused) {
                console.log('Resuming deployment');
                isPaused = false;
                updateButtons();
                return;
            }
            
            console.log('Starting new deployment');
            isPlaying = true;
            isPaused = false;
            currentStep = 0;
            updateButtons();
            executeNextStep();
        }
        
        function pauseDeployment() {
            isPaused = true;
            updateButtons();
        }
        
        function resetSimulation() {
            isPlaying = false;
            isPaused = false;
            currentStep = 0;
            clearTimeout(deploymentInterval);
            
            // Reset all components
            document.querySelectorAll('.component').forEach(comp => {
                comp.classList.remove('active', 'processing');
            });
            
            document.querySelectorAll('.status-indicator').forEach(indicator => {
                indicator.className = 'status-indicator';
            });
            
            document.querySelectorAll('.timeline-step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            document.querySelectorAll('.pod-representation').forEach(pod => {
                pod.classList.remove('visible');
            });
            
            document.getElementById('progressFill').style.width = '0%';
            
            // Reset component states
            resetComponentStates();
            updateButtons();
        }
        
        function toggleSpeed() {
            console.log('toggleSpeed called, current speed:', speed);
            speed = speed === 1 ? 2 : speed === 2 ? 4 : 1;
            console.log('New speed:', speed);
            const speedBtn = document.getElementById('speedBtn');
            if (speedBtn) {
                speedBtn.textContent = `⚡ Speed: ${speed}x`;
                console.log('Speed button updated');
            } else {
                console.log('Speed button not found!');
            }
        }
        
        function updateButtons() {
            document.getElementById('playBtn').disabled = isPlaying && !isPaused;
            document.getElementById('pauseBtn').disabled = !isPlaying || isPaused;
            document.getElementById('playBtn').textContent = isPaused ? '▶️ Resume' : '▶️ Play Deployment';
        }

        // Tab Management Functions
        function switchTab(event, tabName) {
            // Si le conteneur est minimisé, d'abord le restaurer
            const terminalTabs = document.querySelector('.terminal-tabs');
            if (terminalTabs && terminalTabs.classList.contains('minimized')) {
                terminalTabs.classList.remove('minimized');
                const timeline = document.getElementById('timeline');
                const toggleButton = document.querySelector('.timeline-toggle');
                if (timeline && toggleButton) {
                    timeline.classList.remove('collapsed');
                    toggleButton.textContent = '▼';
                }
            }
            
            // Toujours permettre le switch entre onglets
            // Remove active class from all headers and panels
            document.querySelectorAll('.tab-header').forEach(header => {
                header.classList.remove('active');
            });
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Find the actual tab header (in case event.target is a child element)
            const tabHeader = event.target.closest('.tab-header');
            if (tabHeader) {
                tabHeader.classList.add('active');
            }
            
            // Add active class to corresponding panel
            const targetPanel = document.getElementById(tabName + '-panel');
            if (targetPanel) {
                targetPanel.classList.add('active');
            }
            
            // Focus on kubectl input when switching to kubectl tab
            if (tabName === 'kubectl') {
                setTimeout(() => {
                    const terminalInput = document.getElementById('terminalInput');
                    if (terminalInput) terminalInput.focus();
                }, 100);
            }
            
            // Hide notification badge for the active tab
            hideTabNotification(tabName);
            
            console.log(`Switched to tab: ${tabName}`);
        }

        // Terminal Functions
        function handleTerminalInput(event) {
            console.log('handleTerminalInput called', event.key);
            if (event.key === 'Enter') {
                const input = event.target;
                const command = input.value.trim();
                console.log('Command entered:', command);
                
                if (command) {
                    // Add to history
                    terminalHistory.push(command);
                    historyIndex = terminalHistory.length;
                    
                    // Process command
                    console.log('Processing command:', command);
                    processKubectlCommand(command);
                    input.value = '';
                }
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    event.target.value = terminalHistory[historyIndex];
                }
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (historyIndex < terminalHistory.length - 1) {
                    historyIndex++;
                    event.target.value = terminalHistory[historyIndex];
                } else {
                    historyIndex = terminalHistory.length;
                    event.target.value = '';
                }
            }
        }

        function processKubectlCommand(command) {
            console.log('processKubectlCommand called with:', command);
            const output = document.getElementById('terminalOutput');
            console.log('terminalOutput element:', output);
            
            if (!output) {
                console.error('terminalOutput element not found!');
                return;
            }
            
            // Add command to output
            const commandDiv = document.createElement('div');
            commandDiv.innerHTML = `<span style="color: #4CAF50; font-weight: bold;">kubectl></span> ${command}`;
            commandDiv.style.marginBottom = '8px';
            output.appendChild(commandDiv);
            
            // Process the command
            console.log('Calling executeKubectlCommand...');
            const result = executeKubectlCommand(command);
            console.log('Command result:', result);
            const resultDiv = document.createElement('div');
            resultDiv.innerHTML = result;
            resultDiv.style.marginBottom = '15px';
            output.appendChild(resultDiv);
            
            // Auto scroll to bottom
            output.scrollTop = output.scrollHeight;
            
            // Show notification badge on kubectl tab if not active
            const kubectlTab = document.querySelector('.tab-header[onclick*="kubectl"]');
            if (!kubectlTab.classList.contains('active')) {
                showTabNotification('kubectl');
            }
        }

        function clearTerminal() {
            document.getElementById('terminalOutput').innerHTML = '';
        }

        function toggleTerminalFullscreen() {
            const terminalTabs = document.querySelector('.terminal-tabs');
            terminalTabs.classList.toggle('fullscreen');
        }

        // Logs Functions
        function addLogEntry(message, level = 'info') {
            const logsOutput = document.getElementById('logsOutput');
            const timestamp = new Date().toLocaleTimeString();
            
            const logDiv = document.createElement('div');
            logDiv.className = 'log-entry';
            logDiv.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                <span>${message}</span>
            `;
            
            logsOutput.appendChild(logDiv);
            
            if (autoScroll) {
                logsOutput.scrollTop = logsOutput.scrollHeight;
            }
            
            // Show notification badge on logs tab if not active
            const logsTab = document.querySelector('.tab-header[onclick*="logs"]');
            if (!logsTab.classList.contains('active')) {
                showTabNotification('logs');
            }
        }

        function clearLogs() {
            document.getElementById('logsOutput').innerHTML = '';
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.getElementById('autoScrollBtn');
            btn.textContent = autoScroll ? '📍 Auto-scroll: ON' : '📍 Auto-scroll: OFF';
        }

        function showTabNotification(tabName) {
            const badge = document.getElementById(tabName + '-badge');
            if (badge) {
                badge.classList.add('show');
                badge.textContent = '•';
            }
        }

        function hideTabNotification(tabName) {
            const badge = document.getElementById(tabName + '-badge');
            if (badge) {
                badge.classList.remove('show');
            }
        }

        function toggleTimeline() {
            console.log('toggleTimeline called');
            const terminalTabs = document.querySelector('.terminal-tabs');
            const timeline = document.getElementById('timeline');
            const toggleButton = document.querySelector('.timeline-toggle');
            
            console.log('terminalTabs:', terminalTabs);
            console.log('timeline:', timeline);
            console.log('toggleButton:', toggleButton);
            
            if (terminalTabs && timeline && toggleButton) {
                if (terminalTabs.classList.contains('minimized')) {
                    // Restaurer
                    terminalTabs.classList.remove('minimized');
                    timeline.classList.remove('collapsed');
                    toggleButton.textContent = '▼';
                    console.log('Timeline expanded');
                } else {
                    // Minimiser
                    terminalTabs.classList.add('minimized');
                    timeline.classList.add('collapsed');
                    toggleButton.textContent = '▶';
                    console.log('Timeline collapsed');
                }
            }
        }
        
        function executeNextStep() {
            if (!isPlaying || isPaused || currentStep >= steps.length) {
                if (currentStep >= steps.length) {
                    isPlaying = false;
                    updateButtons();
                }
                return;
            }
            
            const step = steps[currentStep];
            const timelineStep = document.getElementById(`step-${currentStep + 1}`);
            
            // Mark previous steps as completed
            for (let i = 0; i < currentStep; i++) {
                const prevStep = document.getElementById(`step-${i + 1}`);
                prevStep.classList.remove('active');
                prevStep.classList.add('completed');
            }
            
            // Activate current step
            timelineStep.classList.add('active');
            
            // Update progress
            const progress = ((currentStep + 1) / steps.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Execute step function
            step.execute();
            
            // Schedule next step
            deploymentInterval = setTimeout(() => {
                currentStep++;
                executeNextStep();
            }, step.duration / speed);
        }
        
        function executeStep1() {
            // kubectl apply - API Server receives request
            const apiServer = document.getElementById('api-server');
            const apiState = document.getElementById('api-state');
            const apiStatus = document.getElementById('api-status');
            
            apiServer.classList.add('processing');
            apiStatus.classList.add('pending');
            
            apiState.innerHTML = `
                <div>🔒 Status: <span class="highlight-new">Processing kubectl request</span></div>
                <div class="data-flow">HTTP Requests: <span class="highlight-new">1 (POST /apis/apps/v1/deployments)</span></div>
                <div class="data-flow">Authentication: <span class="highlight-new">✅ Token validated</span></div>
                <div class="data-flow">Validation: <span class="highlight-new">Parsing YAML manifest</span></div>
            `;
            apiState.classList.add('updated');
            
            // Add logs
            addLogEntry('kubectl apply command received', 'info');
            addLogEntry('API Server: Processing deployment request for webapp-deployment', 'info');
            addLogEntry('Authentication: Token validation successful', 'success');
        }
        
        function executeStep2() {
            // API Server validation phase
            const apiState = document.getElementById('api-state');
            
            apiState.innerHTML = `
                <div>🔒 Status: <span class="highlight-new">Validating deployment manifest</span></div>
                <div class="data-flow">HTTP Requests: 1 (POST /apis/apps/v1/deployments)</div>
                <div class="data-flow">Authentication: ✅ Token validated</div>
                <div class="data-flow">Validation: <span class="highlight-new">✅ Schema valid, RBAC passed</span></div>
                <div class="data-flow">Admission: <span class="highlight-new">MutatingWebhook → ValidatingWebhook</span></div>
            `;
            apiState.classList.add('updated');
            
            // Add logs
            addLogEntry('API Server: Validating deployment manifest schema', 'info');
            addLogEntry('RBAC: User has permission to create deployments in namespace default', 'success');
            addLogEntry('Admission Controllers: MutatingWebhook and ValidatingWebhook completed', 'success');
        }
        
        function executeStep3() {
            // etcd storage
            const etcd = document.getElementById('etcd');
            const etcdState = document.getElementById('etcd-state');
            const etcdStatus = document.getElementById('etcd-status');
            const apiStatus = document.getElementById('api-status');
            
            etcd.classList.add('processing');
            etcdStatus.classList.add('pending');
            apiStatus.classList.remove('pending');
            apiStatus.classList.add('running');
            
            etcdState.innerHTML = `
                <div class="etcd-data">📊 Cluster State: <span class="highlight-new">Storing objects</span></div>
                <div class="data-flow">Keys: <span class="highlight-new">+2 (deployment + service)</span></div>
                <div class="data-flow">Watchers: <span class="highlight-new">Controllers notified</span></div>
                <div class="data-flow">Revision: <span class="highlight-new">1002</span></div>
                <div class="data-flow">New Keys:</div>
                <div class="data-flow">→ /registry/deployments/default/nginx-deployment</div>
                <div class="data-flow">→ /registry/services/default/nginx-service</div>
            `;
            etcdState.classList.add('updated');
            
            // Add logs
            addLogEntry('etcd: Storing deployment and service objects', 'info');
            addLogEntry('etcd: Revision updated to 1002', 'info');
            addLogEntry('etcd: Notifying watchers about new resources', 'success');
        }
        
        function executeStep4() {
            // Controller Manager detects new deployment
            const controller = document.getElementById('controller-manager');
            const controllerState = document.getElementById('controller-state');
            const controllerStatus = document.getElementById('controller-status');
            const etcdStatus = document.getElementById('etcd-status');
            
            controller.classList.add('processing');
            controllerStatus.classList.add('pending');
            etcdStatus.classList.remove('pending');
            etcdStatus.classList.add('running');
            
            controllerState.innerHTML = `
                <div class="controller-action">🔄 Active Controllers: <span class="highlight-new">Deployment Controller triggered</span></div>
                <div class="data-flow">Deployment Controller: <span class="highlight-new">🔥 Processing nginx-deployment</span></div>
                <div class="data-flow">ReplicaSet Controller: <span class="highlight-new">Standing by</span></div>
                <div class="data-flow">Endpoint Controller: Ready</div>
                <div class="data-flow">Action: <span class="highlight-new">Creating ReplicaSet with 3 replicas</span></div>
            `;
            controllerState.classList.add('updated');
        }
        
        function executeStep5() {
            // ReplicaSet creation and Pod specs
            const controllerState = document.getElementById('controller-state');
            const etcdState = document.getElementById('etcd-state');
            
            controllerState.innerHTML = `
                <div class="controller-action">🔄 Active Controllers: Deployment → ReplicaSet created</div>
                <div class="data-flow">Deployment Controller: ✅ ReplicaSet nginx-deployment-abc123 created</div>
                <div class="data-flow">ReplicaSet Controller: <span class="highlight-new">🔥 Creating 3 pods</span></div>
                <div class="data-flow">Endpoint Controller: Ready</div>
                <div class="data-flow">Action: <span class="highlight-new">Generating pod-1, pod-2, pod-3 specs</span></div>
            `;
            
            etcdState.innerHTML = `
                <div class="etcd-data">📊 Cluster State: Adding pod specifications</div>
                <div class="data-flow">Keys: <span class="highlight-new">+4 (replicaset + 3 pods)</span></div>
                <div class="data-flow">Watchers: Scheduler notified</div>
                <div class="data-flow">Revision: <span class="highlight-new">1006</span></div>
                <div class="data-flow">New Keys:</div>
                <div class="data-flow">→ /registry/replicasets/default/nginx-deployment-abc123</div>
                <div class="data-flow">→ /registry/pods/default/nginx-deployment-abc123-pod1</div>
                <div class="data-flow">→ /registry/pods/default/nginx-deployment-abc123-pod2</div>
                <div class="data-flow">→ /registry/pods/default/nginx-deployment-abc123-pod3</div>
            `;
            etcdState.classList.add('updated');
            controllerState.classList.add('updated');
        }
        
        function executeStep6() {
            // Scheduler assigns pods to nodes
            const scheduler = document.getElementById('scheduler');
            const schedulerState = document.getElementById('scheduler-state');
            const schedulerStatus = document.getElementById('scheduler-status');
            const controllerStatus = document.getElementById('controller-status');
            
            scheduler.classList.add('processing');
            schedulerStatus.classList.add('pending');
            controllerStatus.classList.remove('pending');
            controllerStatus.classList.add('running');
            
            schedulerState.innerHTML = `
                <div class="scheduler-decision">🎯 Scheduling Queue: <span class="highlight-new">Processing 3 pods</span></div>
                <div class="data-flow">Pending Pods: <span class="highlight-new">3 → 0</span></div>
                <div class="data-flow">Node Evaluation: <span class="highlight-new">🔥 Active</span></div>
                <div class="data-flow">Available Nodes: 3</div>
                <div class="data-flow">Decisions:</div>
                <div class="data-flow">→ pod-1: node-1 (Score: 85) ✅</div>
                <div class="data-flow">→ pod-2: node-2 (Score: 92) ✅</div>
                <div class="data-flow">→ pod-3: node-1 (Score: 88) ✅</div>
                <div class="data-flow">Factors: CPU: 40%, RAM: 30%, Affinity: +15</div>
            `;
            schedulerState.classList.add('updated');
        }
        
        function executeStep7() {
            // Kubelet receives pod assignments
            const kubelet = document.getElementById('kubelet');
            const kubeletState = document.getElementById('kubelet-state');
            const kubeletStatus = document.getElementById('kubelet-status');
            const schedulerStatus = document.getElementById('scheduler-status');
            
            kubelet.classList.add('processing');
            kubeletStatus.classList.add('pending');
            schedulerStatus.classList.remove('pending');
            schedulerStatus.classList.add('running');
            
            kubeletState.innerHTML = `
                <div class="kubelet-operation">🛠️ Node Operations: <span class="highlight-new">2 pods assigned to node-1</span></div>
                <div class="data-flow">Assigned Pods: <span class="highlight-new">2 (pod-1, pod-3)</span></div>
                <div class="data-flow">Container Runtime: <span class="highlight-new">🔥 Preparing sandboxes</span></div>
                <div class="data-flow">Image Cache: nginx:1.21 not cached</div>
                <div class="data-flow">Actions:</div>
                <div class="data-flow">→ CreatePodSandbox() called</div>
                <div class="data-flow">→ Network namespace created</div>
                <div class="data-flow">→ Volume mounts prepared</div>
            `;
            kubeletState.classList.add('updated');
        }
        
        function executeStep8() {
            // Image pulling phase
            const kubeletState = document.getElementById('kubelet-state');
            
            kubeletState.innerHTML = `
                <div class="kubelet-operation">🛠️ Node Operations: Image pulling in progress</div>
                <div class="data-flow">Assigned Pods: 2 (pod-1, pod-3)</div>
                <div class="data-flow">Container Runtime: <span class="highlight-new">⬇️ Pulling nginx:1.21</span></div>
                <div class="data-flow">Image Cache: <span class="highlight-new">Downloading layers...</span></div>
                <div class="data-flow">Progress:</div>
                <div class="data-flow">→ Layer 1/5: ████████████ 100%</div>
                <div class="data-flow">→ Layer 2/5: ████████████ 100%</div>
                <div class="data-flow">→ Config: ████████████ 100%</div>
                <div class="data-flow">→ <span class="highlight-new">✅ Image nginx:1.21 cached</span></div>
            `;
            kubeletState.classList.add('updated');
        }
        
        function executeStep9() {
            // Container startup
            const kubeletState = document.getElementById('kubelet-state');
            const kubeletStatus = document.getElementById('kubelet-status');
            
            kubeletStatus.classList.remove('pending');
            kubeletStatus.classList.add('running');
            
            kubeletState.innerHTML = `
                <div class="kubelet-operation">🛠️ Node Operations: <span class="highlight-new">🚀 Containers starting</span></div>
                <div class="data-flow">Assigned Pods: 2 (pod-1, pod-3)</div>
                <div class="data-flow">Container Runtime: <span class="highlight-new">✅ StartContainer() successful</span></div>
                <div class="data-flow">Image Cache: ✅ nginx:1.21 ready</div>
                <div class="data-flow">Pod Status:</div>
                <div class="data-flow">→ pod-1: <span class="highlight-new">🟢 Running</span> (IP: 10.244.1.10)</div>
                <div class="data-flow">→ pod-3: <span class="highlight-new">🟢 Running</span> (IP: 10.244.1.12)</div>
                <div class="data-flow">Health checks: <span class="highlight-new">Starting readiness probes</span></div>
            `;
            kubeletState.classList.add('updated');
            
            // Show pods visually
            document.getElementById('pod-1').classList.add('visible');
            document.getElementById('pod-3').classList.add('visible');
        }
        
        function executeStep10() {
            // Service endpoints and network proxy (dynamic based on configuration)
            const proxy = document.getElementById('kube-proxy') || document.getElementById('cilium');
            const proxyState = document.getElementById('proxy-state');
            const proxyStatus = document.getElementById('proxy-status');
            
            if (!proxy) {
                console.error('Proxy component not found');
                return;
            }
            
            proxy.classList.add('processing');
            proxyStatus.classList.add('pending');
            
            // Different content based on proxy type
            if (clusterConfig.networkProxy === 'cilium') {
                proxyState.innerHTML = `
                    <div class="proxy-rules">🔬 eBPF Programs: <span class="highlight-new">Service map updated</span></div>
                    <div class="data-flow">Maps: <span class="highlight-new">cilium_lb4_services_v2 +3 entries</span></div>
                    <div class="data-flow">Service endpoints: <span class="highlight-new">3 (nginx-service)</span></div>
                    <div class="data-flow">XDP/TC hooks: <span class="highlight-new">🔥 Processing traffic</span></div>
                    <div class="data-flow">Network policies: <span class="highlight-new">✅ Enforced</span></div>
                    <div class="data-flow">Load balancer entries:</div>
                    <div class="data-flow">→ 10.96.123.45:80 → 10.244.1.10:80</div>
                    <div class="data-flow">→ 10.96.123.45:80 → 10.244.1.12:80</div>
                    <div class="data-flow">Observability: <span class="highlight-new">📊 Flow logs active</span></div>
                `;
            } else {
                proxyState.innerHTML = `
                    <div class="proxy-rules">🌐 Network Rules: <span class="highlight-new">Service endpoints updated</span></div>
                    <div class="data-flow">iptables chains: <span class="highlight-new">+3 rules added</span></div>
                    <div class="data-flow">Service endpoints: <span class="highlight-new">3 (nginx-service)</span></div>
                    <div class="data-flow">Load balancing: <span class="highlight-new">🔥 Active</span></div>
                    <div class="data-flow">New rules:</div>
                    <div class="data-flow">→ KUBE-SVC-NGINX -j KUBE-SEP-POD1</div>
                    <div class="data-flow">→ KUBE-SEP-POD1 -j DNAT --to 10.244.1.10:80</div>
                    <div class="data-flow">→ KUBE-SEP-POD3 -j DNAT --to 10.244.1.12:80</div>
                    <div class="data-flow">ClusterIP: <span class="highlight-new">10.96.123.45 → Load balanced</span></div>
                `;
            }
            proxyState.classList.add('updated');
            
            setTimeout(() => {
                proxyStatus.classList.remove('pending');
                proxyStatus.classList.add('running');
                document.getElementById('pod-2').classList.add('visible');
            }, 1000);
        }
        
        function executeStep11() {
            // DNS registration
            const dns = document.getElementById('dns');
            const dnsState = document.getElementById('dns-state');
            const dnsStatus = document.getElementById('dns-status');
            
            dns.classList.add('processing');
            dnsStatus.classList.add('pending');
            
            dnsState.innerHTML = `
                <div class="dns-records">📋 DNS Records: <span class="highlight-new">Service registered</span></div>
                <div class="data-flow">A Records: <span class="highlight-new">+1 nginx-service</span></div>
                <div class="data-flow">Cache: <span class="highlight-new">Updated</span></div>
                <div class="data-flow">Queries/sec: <span class="highlight-new">5 (health checks)</span></div>
                <div class="data-flow">New DNS entries:</div>
                <div class="data-flow">→ nginx-service.default.svc.cluster.local</div>
                <div class="data-flow">   A 10.96.123.45 (ClusterIP)</div>
                <div class="data-flow">→ TTL: 30s, Cache: Ready</div>
            `;
            dnsState.classList.add('updated');
            
            setTimeout(() => {
                dnsStatus.classList.remove('pending');
                dnsStatus.classList.add('running');
            }, 500);
        }
        
        function executeStep12() {
            // Final health checks and completion
            const kubeletState = document.getElementById('kubelet-state');
            
            kubeletState.innerHTML = `
                <div class="kubelet-operation">🛠️ Node Operations: <span class="highlight-new">✅ Deployment completed</span></div>
                <div class="data-flow">Assigned Pods: 2 (pod-1, pod-3)</div>
                <div class="data-flow">Container Runtime: ✅ All containers healthy</div>
                <div class="data-flow">Image Cache: ✅ nginx:1.21 ready</div>
                <div class="data-flow">Pod Status:</div>
                <div class="data-flow">→ pod-1: <span class="highlight-new">🟢 Ready</span> (Readiness: ✅)</div>
                <div class="data-flow">→ pod-3: <span class="highlight-new">🟢 Ready</span> (Readiness: ✅)</div>
                <div class="data-flow">Health checks: <span class="highlight-new">✅ All probes passing</span></div>
                <div class="data-flow">Service: <span class="highlight-new">✅ Traffic routing active</span></div>
            `;
            kubeletState.classList.add('updated');
            
            // Mark deployment as complete
            setTimeout(() => {
                document.querySelectorAll('.status-indicator.pending').forEach(indicator => {
                    indicator.classList.remove('pending');
                    indicator.classList.add('running');
                });
                
                document.querySelectorAll('.component.processing').forEach(comp => {
                    comp.classList.remove('processing');
                    comp.classList.add('active');
                });
            }, 1000);
        }
        
        function resetComponentStates() {
            // Reset API Server
            document.getElementById('api-state').innerHTML = `
                <div>🔒 Status: Waiting for requests...</div>
                <div class="data-flow">HTTP Requests: 0</div>
                <div class="data-flow">Authentication: Ready</div>
                <div class="data-flow">Validation: Standby</div>
            `;
            
            // Reset etcd
            document.getElementById('etcd-state').innerHTML = `
                <div class="etcd-data">📊 Cluster State:</div>
                <div class="data-flow">Keys: 0 deployment-related</div>
                <div class="data-flow">Watchers: Active</div>
                <div class="data-flow">Revision: 1000</div>
            `;
            
            // Reset Scheduler
            document.getElementById('scheduler-state').innerHTML = `
                <div class="scheduler-decision">🎯 Scheduling Queue:</div>
                <div class="data-flow">Pending Pods: 0</div>
                <div class="data-flow">Node Evaluation: Idle</div>
                <div class="data-flow">Available Nodes: 3</div>
            `;
            
            // Reset Controller Manager
            document.getElementById('controller-state').innerHTML = `
                <div class="controller-action">🔄 Active Controllers:</div>
                <div class="data-flow">Deployment Controller: Watching</div>
                <div class="data-flow">ReplicaSet Controller: Idle</div>
                <div class="data-flow">Endpoint Controller: Ready</div>
            `;
            
            // Reset Kubelet
            document.getElementById('kubelet-state').innerHTML = `
                <div class="kubelet-operation">🛠️ Node Operations:</div>
                <div class="data-flow">Assigned Pods: 0</div>
                <div class="data-flow">Container Runtime: Ready</div>
                <div class="data-flow">Image Cache: nginx:1.21 not cached</div>
            `;
            
            // Reset proxy (dynamic based on configuration)
            const proxyState = document.getElementById('proxy-state');
            if (clusterConfig.networkProxy === 'cilium') {
                proxyState.innerHTML = `
                    <div class="proxy-rules">🔬 eBPF Programs:</div>
                    <div class="data-flow">Maps: tc_globals, cilium_policy</div>
                    <div class="data-flow">XDP/TC hooks: active</div>
                    <div class="data-flow">Network policies: enforced</div>
                    <div class="data-flow">Observability: enabled</div>
                `;
            } else {
                proxyState.innerHTML = `
                    <div class="proxy-rules">🌐 Network Rules:</div>
                    <div class="data-flow">iptables chains: default</div>
                    <div class="data-flow">Service endpoints: 0</div>
                    <div class="data-flow">Load balancing: inactive</div>
                `;
            }
            
            // Reset DNS (dynamic based on configuration)
            const dnsState = document.getElementById('dns-state');
            if (clusterConfig.dns === 'coredns-custom') {
                dnsState.innerHTML = `
                    <div class="dns-records">📋 DNS Records:</div>
                    <div class="data-flow">A Records: services + external</div>
                    <div class="data-flow">External DNS: AWS Route53</div>
                    <div class="data-flow">Cache: Enhanced</div>
                    <div class="data-flow">Queries/sec: 0</div>
                `;
            } else {
                dnsState.innerHTML = `
                    <div class="dns-records">📋 DNS Records:</div>
                    <div class="data-flow">A Records: default services only</div>
                    <div class="data-flow">Cache: Clean</div>
                    <div class="data-flow">Queries/sec: 0</div>
                `;
            }
        }
        
        function toggleConfig() {
            const configContent = document.querySelector('.config-content');
            const toggleButton = document.querySelector('.config-toggle');
            
            if (configContent.classList.contains('collapsed')) {
                configContent.classList.remove('collapsed');
                toggleButton.textContent = '▼';
            } else {
                configContent.classList.add('collapsed');
                toggleButton.textContent = '▶';
            }
        }

        // Live Logs Integration
        function updateLiveLogs(step) {
            const logsContent = document.getElementById('logsContent');
            
            const logMessages = {
                1: '📋 Deployment manifest received...',
                3: '💾 Deployment stored in etcd: webapp-deployment',
                4: '🎮 Controller creating ReplicaSet...',
                5: '📋 ReplicaSet webapp-deployment-abc123 created',
                6: '🎯 Scheduler assigning pods to nodes...',
                7: '🤖 Kubelet creating pod sandboxes...',
                8: '⬇️ Pulling image nginx:1.21...\n✅ Image pull complete',
                9: '🚀 Starting containers...\n📄 Container logs:\n' +
                   '/docker-entrypoint.sh: Configuration complete\n' +
                   '2024/01/30 12:34:56 [notice] nginx/1.21.6\n' +
                   '2024/01/30 12:34:56 [notice] start worker processes',
                10: '🌐 Service endpoints updated\n✅ Traffic routing active',
                11: '🔍 DNS records registered\n✅ webapp-service.default.svc.cluster.local',
                12: '🩺 Health checks passing\n✅ All pods ready and serving traffic'
            };
            
            if (logMessages[step]) {
                const logDiv = document.createElement('div');
                logDiv.style.marginBottom = '10px';
                logDiv.style.borderLeft = '3px solid #4CAF50';
                logDiv.style.paddingLeft = '10px';
                logDiv.innerHTML = `<span style="color: #666; font-size: 0.7em;">[${new Date().toLocaleTimeString()}]</span><br>${logMessages[step]}`;
                logsContent.appendChild(logDiv);
                logsContent.scrollTop = logsContent.scrollHeight;
            }
        }
        
        // Configuration state
        let clusterConfig = {
            networkProxy: 'kube-proxy',
            ingress: 'none',
            dns: 'coredns'
        };
        
        function updateNetworkProxy(proxyType) {
            console.log('Network proxy changed to:', proxyType);
            clusterConfig.networkProxy = proxyType;
            let proxyComponent = document.getElementById('kube-proxy') || document.getElementById('cilium');
            const proxyHeader = proxyComponent.querySelector('.component-header span:nth-child(2)');
            const proxyState = document.getElementById('proxy-state');
            
            // Reset component state first
            proxyComponent.classList.remove('processing', 'active');
            const proxyStatus = document.getElementById('proxy-status');
            proxyStatus.classList.remove('pending', 'running');
            
            if (proxyType === 'cilium') {
                proxyComponent.id = 'cilium';
                proxyHeader.textContent = 'Cilium';
                proxyComponent.querySelector('.component-icon').textContent = '🔬';
                proxyState.innerHTML = `
                    <div class="proxy-rules">🔬 eBPF Programs:</div>
                    <div class="data-flow">Maps: tc_globals, cilium_policy</div>
                    <div class="data-flow">XDP/TC hooks: active</div>
                    <div class="data-flow">Network policies: enforced</div>
                    <div class="data-flow">Observability: enabled</div>
                `;
            } else {
                proxyComponent.id = 'kube-proxy';
                proxyHeader.textContent = 'kube-proxy';
                proxyComponent.querySelector('.component-icon').textContent = '🔀';
                proxyState.innerHTML = `
                    <div class="proxy-rules">🌐 Network Rules:</div>
                    <div class="data-flow">iptables chains: default</div>
                    <div class="data-flow">Service endpoints: 0</div>
                    <div class="data-flow">Load balancing: inactive</div>
                `;
            }
            
            // Update steps timeline for Cilium
            updateTimelineForConfig();
            // Update YAML manifest
            updateYAMLManifest();
            
            // If simulation is in progress, reset component states to match new config
            if (isPlaying || isPaused) {
                resetComponentStates();
            }
        }
        
        function updateIngress(ingressType) {
            console.log('Ingress changed to:', ingressType);
            clusterConfig.ingress = ingressType;
            updateTimelineForConfig();
            
            // Update YAML manifest to include ingress if selected
            updateYAMLManifest();
            
            // If simulation is in progress, reset component states to match new config
            if (isPlaying || isPaused) {
                resetComponentStates();
            }
        }
        
        function updateDNS(dnsType) {
            clusterConfig.dns = dnsType;
            const dnsState = document.getElementById('dns-state');
            
            if (dnsType === 'coredns-custom') {
                dnsState.innerHTML = `
                    <div class="dns-records">📋 DNS Records:</div>
                    <div class="data-flow">A Records: services + external</div>
                    <div class="data-flow">External DNS: AWS Route53</div>
                    <div class="data-flow">Cache: Enhanced</div>
                    <div class="data-flow">Queries/sec: 0</div>
                `;
            } else {
                dnsState.innerHTML = `
                    <div class="dns-records">📋 DNS Records:</div>
                    <div class="data-flow">A Records: default services only</div>
                    <div class="data-flow">Cache: Clean</div>
                    <div class="data-flow">Queries/sec: 0</div>
                `;
            }
            // Update YAML manifest for DNS changes
            updateYAMLManifest();
            
            // If simulation is in progress, reset component states to match new config
            if (isPlaying || isPaused) {
                resetComponentStates();
            }
        }
        
        function updateTimelineForConfig() {
            // Add new steps based on configuration
            const step10 = document.getElementById('step-10');
            const step11 = document.getElementById('step-11');
            
            if (clusterConfig.networkProxy === 'cilium') {
                step10.innerHTML = `
                    <strong>10. Cilium Network Setup</strong>
                    <div class="step-detail">eBPF programs loaded, network policies applied</div>
                `;
            } else {
                step10.innerHTML = `
                    <strong>10. Service Endpoints</strong>
                    <div class="step-detail">kube-proxy updates iptables rules</div>
                `;
            }
            
            if (clusterConfig.ingress !== 'none') {
                step11.innerHTML = `
                    <strong>11. Ingress Configuration</strong>
                    <div class="step-detail">${clusterConfig.ingress} routes configured</div>
                `;
            } else {
                step11.innerHTML = `
                    <strong>11. DNS Registration</strong>
                    <div class="step-detail">webapp-service.default.svc.cluster.local</div>
                `;
            }
        }
        
        function updateYAMLManifest() {
            const yamlContent = document.getElementById('yaml-content');
            if (!yamlContent) {
                console.error('YAML content element not found');
                return;
            }
            console.log('Updating YAML manifest with config:', clusterConfig);
            let yaml = `apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp-deployment
  labels:
    app: webapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: webapp
  template:
    metadata:
      labels:
        app: webapp
    spec:
      containers:
      - name: webapp
        image: nginx:1.21
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
---
apiVersion: v1
kind: Service
metadata:
  name: webapp-service
  labels:
    app: webapp
spec:
  selector:
    app: webapp
  ports:
  - name: http
    port: 80
    targetPort: 80
    protocol: TCP
  type: ClusterIP`;

            if (clusterConfig.ingress === 'nginx') {
                yaml += `
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: webapp-ingress
  labels:
    app: webapp
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
spec:
  rules:
  - host: webapp.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: webapp-service
            port:
              number: 80`;
            } else if (clusterConfig.ingress === 'traefik') {
                yaml += `
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: webapp-ingressroute
  labels:
    app: webapp
spec:
  entryPoints:
  - web
  routes:
  - match: Host(\`webapp.example.com\`)
    kind: Rule
    services:
    - name: webapp-service
      port: 80`;
            }
            
            // Use innerHTML with proper formatting preserving spaces
            yamlContent.innerHTML = '<pre>' + yaml + '</pre>';
        }
        
        // Initialize YAML manifest and new tabs when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateYAMLManifest();
            initializeKubectlShell();
            initializeTabs();
        });

        // Tab System Functions
        function switchTabProgrammatically(tabName) {
            // Remove active class from all headers and panels
            document.querySelectorAll('.tab-header').forEach(header => header.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
            
            // Add active class to selected tab
            const targetHeader = document.querySelector(`[onclick*="${tabName}"]`);
            if (targetHeader) targetHeader.classList.add('active');
            document.getElementById(tabName + '-panel').classList.add('active');
            
            // Focus on kubectl input when switching to kubectl tab
            if (tabName === 'kubectl') {
                setTimeout(() => {
                    const terminalInput = document.getElementById('terminalInput');
                    if (terminalInput) terminalInput.focus();
                }, 100);
            }
        }

        function initializeTabs() {
            // Keep the original startDeployment without auto-switching tabs
            // This allows users to watch the timeline during deployment
            updateTabIndicators();
        }

        function updateTabIndicators() {
            // Add notification badges to tabs when relevant
            const kubectlTab = document.querySelector('.tab-header:nth-child(2)');
            if (currentStep >= 8) {
                kubectlTab.innerHTML = '💻 kubectl <span style="background: #4CAF50; border-radius: 50%; padding: 2px 6px; font-size: 0.7em; margin-left: 5px;">!</span>';
            }
        }

        // kubectl Shell Implementation  
        // Using terminalHistory and historyIndex already declared above
        let shellCommandIndex = 0;

        // Simulate cluster data based on current simulation state
        function getClusterData() {
            const podsRunning = currentStep >= 8;
            const serviceActive = currentStep >= 9;
            const podsCreated = currentStep >= 5; // Pods créés dès l'étape 5
            
            return {
                pods: podsCreated ? [
                    {
                        name: 'webapp-deployment-abc123-pod1',
                        ready: podsRunning ? '1/1' : '0/1',
                        status: podsRunning ? 'Running' : 'Pending',
                        restarts: '0',
                        age: podsRunning ? '2m' : '30s',
                        ip: podsRunning ? '10.244.1.10' : '<none>',
                        node: currentStep >= 6 ? 'node-1' : '<none>'
                    },
                    {
                        name: 'webapp-deployment-abc123-pod2',
                        ready: podsRunning ? '1/1' : '0/1',
                        status: podsRunning ? 'Running' : 'Pending',
                        restarts: '0',
                        age: podsRunning ? '2m' : '30s',
                        ip: podsRunning ? '10.244.2.11' : '<none>',
                        node: currentStep >= 6 ? 'node-2' : '<none>'
                    },
                    {
                        name: 'webapp-deployment-abc123-pod3',
                        ready: podsRunning ? '1/1' : '0/1',
                        status: podsRunning ? 'Running' : 'Pending',
                        restarts: '0',
                        age: podsRunning ? '2m' : '30s',
                        ip: podsRunning ? '10.244.1.12' : '<none>',
                        node: currentStep >= 6 ? 'node-1' : '<none>'
                    }
                ] : [
                    // Pods par défaut même sans déploiement
                    {
                        name: 'coredns-558bd4d5db-abc12',
                        ready: '1/1',
                        status: 'Running',
                        restarts: '0',
                        age: '30d',
                        ip: '10.244.0.2',
                        node: 'control-plane'
                    },
                    {
                        name: 'coredns-558bd4d5db-def34',
                        ready: '1/1',
                        status: 'Running',
                        restarts: '0',
                        age: '30d',
                        ip: '10.244.0.3',
                        node: 'control-plane'
                    }
                ],
                services: [
                    {
                        name: 'kubernetes',
                        type: 'ClusterIP',
                        clusterIp: '10.96.0.1',
                        externalIp: '<none>',
                        ports: '443/TCP',
                        age: '30d'
                    },
                    {
                        name: 'webapp-service',
                        type: 'ClusterIP',
                        clusterIp: serviceActive ? '10.96.123.45' : '<pending>',
                        externalIp: '<none>',
                        ports: serviceActive ? '80/TCP' : '<none>',
                        age: serviceActive ? '2m' : '30s'
                    }
                ],
                deployments: [
                    {
                        name: 'webapp-deployment',
                        ready: podsRunning ? '3/3' : '0/3',
                        upToDate: currentStep >= 4 ? '3' : '0',
                        available: podsRunning ? '3' : '0',
                        age: currentStep >= 3 ? '2m' : '30s'
                    }
                ],
                replicasets: [
                    {
                        name: 'webapp-deployment-abc123',
                        desired: currentStep >= 4 ? '3' : '0',
                        current: podsRunning ? '3' : currentStep >= 5 ? '3' : '0',
                        ready: podsRunning ? '3' : '0',
                        age: currentStep >= 4 ? '2m' : '0s'
                    }
                ],
                configmaps: [
                    {
                        name: 'kube-root-ca.crt',
                        data: '1',
                        age: '30d'
                    },
                    {
                        name: 'coredns',
                        data: '2',
                        age: '30d'
                    }
                ],
                secrets: [
                    {
                        name: 'default-token-xyz123',
                        type: 'kubernetes.io/service-account-token',
                        data: '3',
                        age: '30d'
                    }
                ],
                events: [
                    currentStep >= 1 ? {
                        lastSeen: '2m',
                        firstSeen: '2m',
                        count: '1',
                        name: 'webapp-deployment.created',
                        kind: 'Deployment',
                        subobject: '',
                        type: 'Normal',
                        reason: 'DeploymentCreated',
                        source: 'deployment-controller',
                        message: 'Created deployment webapp-deployment'
                    } : null,
                    currentStep >= 4 ? {
                        lastSeen: '2m',
                        firstSeen: '2m',
                        count: '1',
                        name: 'webapp-deployment-abc123.created',
                        kind: 'ReplicaSet',
                        subobject: '',
                        type: 'Normal',
                        reason: 'ReplicaSetCreated',
                        source: 'deployment-controller',
                        message: 'Created ReplicaSet webapp-deployment-abc123'
                    } : null,
                    currentStep >= 6 ? {
                        lastSeen: '2m',
                        firstSeen: '2m',
                        count: '3',
                        name: 'webapp-deployment-abc123-pod1.scheduled',
                        kind: 'Pod',
                        subobject: '',
                        type: 'Normal',
                        reason: 'Scheduled',
                        source: 'default-scheduler',
                        message: 'Successfully assigned default/webapp-deployment-abc123-pod1 to node-1'
                    } : null,
                    currentStep >= 8 ? {
                        lastSeen: '1m',
                        firstSeen: '1m',
                        count: '3',
                        name: 'webapp-deployment-abc123-pod1.pulled',
                        kind: 'Pod',
                        subobject: 'spec.containers{webapp}',
                        type: 'Normal',
                        reason: 'Pulled',
                        source: 'kubelet',
                        message: 'Container image "nginx:1.21" already present on machine'
                    } : null
                ].filter(Boolean),
                nodes: [
                    {
                        name: 'node-1',
                        status: 'Ready',
                        roles: '<none>',
                        age: '30d',
                        version: 'v1.28.0'
                    },
                    {
                        name: 'node-2',
                        status: 'Ready',
                        roles: '<none>',
                        age: '30d',
                        version: 'v1.28.0'
                    },
                    {
                        name: 'control-plane',
                        status: 'Ready',
                        roles: 'control-plane',
                        age: '30d',
                        version: 'v1.28.0'
                    }
                ],
                crds: [
                    {
                        name: 'ciliumidentities.cilium.io',
                        created: '2024-01-15T10:30:00Z',
                        apiVersion: 'v2',
                        scope: 'Cluster'
                    },
                    {
                        name: 'ciliumnetworkpolicies.cilium.io',
                        created: '2024-01-15T10:30:00Z',
                        apiVersion: 'v2',
                        scope: 'Namespaced'
                    }
                ]
            };
        }

        function toggleKubectlShell() {
            const shell = document.getElementById('kubectlShell');
            const toggle = shell.querySelector('.shell-toggle');
            
            if (shell.classList.contains('open')) {
                shell.classList.remove('open');
                toggle.textContent = '▼';
            } else {
                shell.classList.add('open');
                toggle.textContent = '▲';
                // Focus on input when opening
                setTimeout(() => {
                    const terminalInput = document.getElementById('terminalInput');
                    if (terminalInput) terminalInput.focus();
                }, 300);
            }
        }

        function initializeKubectlShell() {
            const shellInput = document.getElementById('terminalInput');
            const autocompleteSuggestions = document.getElementById('autocompleteSuggestions');
            
            if (!shellInput) {
                console.log('Terminal input not found, skipping shell initialization');
                return;
            }
            
            if (!autocompleteSuggestions) {
                console.log('Autocomplete suggestions element not found, skipping autocomplete initialization');
                return;
            }
            
            // Commands and resources for autocomplete
            const commands = ['get', 'describe', 'logs', 'api-resources'];
            const resources = [
                'pods', 'po', 'services', 'svc', 'deployments', 'deploy', 'replicasets', 'rs',
                'configmaps', 'cm', 'secrets', 'nodes', 'no', 'events', 'ev', 'crd', 'all',
                'namespaces', 'ns', 'persistentvolumes', 'pv', 'persistentvolumeclaims', 'pvc',
                'endpoints', 'ep'
            ];
            const flags = ['-o yaml', '-o json', '--watch', '-w', '--no-headers'];
            
            let selectedSuggestion = -1;
            
            shellInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    executeKubectlCommand(this.value.trim());
                    this.value = '';
                    hideSuggestions();
                    e.preventDefault();
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    // Handle tab completion
                    const suggestions = getSuggestions(this.value);
                    if (suggestions.length === 1) {
                        this.value = suggestions[0];
                        hideSuggestions();
                    } else if (suggestions.length > 1) {
                        showSuggestions(suggestions);
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (autocompleteSuggestions && autocompleteSuggestions.style.display === 'block') {
                        navigateSuggestions(-1);
                    } else {
                        navigateHistory(-1);
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (autocompleteSuggestions && autocompleteSuggestions.style.display === 'block') {
                        navigateSuggestions(1);
                    } else {
                        navigateHistory(1);
                    }
                } else if (e.key === 'Escape') {
                    hideSuggestions();
                }
            });
            
            shellInput.addEventListener('input', function() {
                const suggestions = getSuggestions(this.value);
                if (suggestions.length > 0 && this.value.length > 0) {
                    showSuggestions(suggestions);
                } else {
                    hideSuggestions();
                }
            });
            
            function getSuggestions(input) {
                const words = input.toLowerCase().split(' ');
                const lastWord = words[words.length - 1];
                
                if (words.length === 1) {
                    return commands.filter(cmd => cmd.startsWith(lastWord));
                } else if (words.length === 2 && words[0] === 'get') {
                    return resources.filter(res => res.startsWith(lastWord));
                } else if (words.length === 2 && (words[0] === 'describe' || words[0] === 'logs')) {
                    return resources.filter(res => res.startsWith(lastWord) && res !== 'all');
                } else if (lastWord.startsWith('-')) {
                    return flags.filter(flag => flag.startsWith(lastWord));
                }
                
                return [];
            }
            
            function showSuggestions(suggestions) {
                if (!autocompleteSuggestions) return;
                
                autocompleteSuggestions.innerHTML = '';
                suggestions.forEach((suggestion, index) => {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.textContent = suggestion;
                    item.addEventListener('click', () => {
                        const words = shellInput.value.split(' ');
                        words[words.length - 1] = suggestion;
                        shellInput.value = words.join(' ') + ' ';
                        hideSuggestions();
                        shellInput.focus();
                    });
                    autocompleteSuggestions.appendChild(item);
                });
                autocompleteSuggestions.style.display = 'block';
                selectedSuggestion = -1;
            }
            
            function hideSuggestions() {
                if (!autocompleteSuggestions) return;
                
                autocompleteSuggestions.style.display = 'none';
                selectedSuggestion = -1;
            }
            
            function navigateSuggestions(direction) {
                if (!autocompleteSuggestions) return;
                
                const items = autocompleteSuggestions.querySelectorAll('.autocomplete-item');
                if (items.length === 0) return;
                
                if (selectedSuggestion >= 0) {
                    items[selectedSuggestion].classList.remove('selected');
                }
                
                selectedSuggestion += direction;
                if (selectedSuggestion < 0) selectedSuggestion = items.length - 1;
                if (selectedSuggestion >= items.length) selectedSuggestion = 0;
                
                items[selectedSuggestion].classList.add('selected');
                
                // Apply suggestion to input
                const words = shellInput.value.split(' ');
                words[words.length - 1] = items[selectedSuggestion].textContent;
                shellInput.value = words.join(' ');
            }
            
            function navigateHistory(direction) {
                if (terminalHistory.length === 0) return;
                
                historyIndex += direction;
                if (historyIndex < 0) historyIndex = 0;
                if (historyIndex >= terminalHistory.length) historyIndex = terminalHistory.length - 1;
                
                shellInput.value = terminalHistory[historyIndex];
            }
        }


        function handleGetCommand(resource, resourceName, flags, clusterData) {
            const outputYaml = flags.includes('-o') && (flags.includes('yaml') || flags.includes('json'));
            const outputJson = flags.includes('-o') && flags.includes('json');
            
            // Normalize resource shortcuts
            const resourceMap = {
                'po': 'pods', 'pod': 'pods',
                'svc': 'services', 'service': 'services',
                'deploy': 'deployments', 'deployment': 'deployments',
                'rs': 'replicasets', 'replicaset': 'replicasets',
                'cm': 'configmaps', 'configmap': 'configmaps',
                'secret': 'secrets',
                'ev': 'events', 'event': 'events',
                'no': 'nodes', 'node': 'nodes',
                'ns': 'namespaces', 'namespace': 'namespaces',
                'pv': 'persistentvolumes', 'persistentvolume': 'persistentvolumes',
                'pvc': 'persistentvolumeclaims', 'persistentvolumeclaim': 'persistentvolumeclaims',
                'ep': 'endpoints', 'endpoint': 'endpoints',
                'customresourcedefinitions': 'crd', 'customresourcedefinition': 'crd'
            };
            
            const normalizedResource = resourceMap[resource] || resource;
            
            switch (normalizedResource) {
                case 'pods':
                    if (resourceName && resourceName !== '-o') {
                        const pod = clusterData.pods.find(p => p.name.includes(resourceName) || p.name === resourceName);
                        if (!pod) {
                            return `<div class="error-output">Error from server (NotFound): pods "${resourceName}" not found</div>`;
                        }
                        if (outputYaml) {
                            return outputJson ? getPodJson(pod) : getPodYaml(pod);
                        }
                        return getSinglePodTable(pod);
                    }
                    return outputYaml ? (outputJson ? getPodsJson(clusterData.pods) : getPodsYaml(clusterData.pods)) : getPodsTable(clusterData.pods);
                    
                case 'services':
                    return outputYaml ? (outputJson ? getServicesJson(clusterData.services) : getServicesYaml(clusterData.services)) : getServicesTable(clusterData.services);
                    
                case 'deployments':
                    return outputYaml ? (outputJson ? getDeploymentsJson(clusterData.deployments) : getDeploymentsYaml(clusterData.deployments)) : getDeploymentsTable(clusterData.deployments);
                    
                case 'replicasets':
                    return outputYaml ? (outputJson ? getReplicaSetsJson(clusterData.replicasets) : getReplicaSetsYaml(clusterData.replicasets)) : getReplicaSetsTable(clusterData.replicasets);
                    
                case 'configmaps':
                    return outputYaml ? (outputJson ? getConfigMapsJson(clusterData.configmaps) : getConfigMapsYaml(clusterData.configmaps)) : getConfigMapsTable(clusterData.configmaps);
                    
                case 'secrets':
                    return outputYaml ? (outputJson ? getSecretsJson(clusterData.secrets) : getSecretsYaml(clusterData.secrets)) : getSecretsTable(clusterData.secrets);
                    
                case 'events':
                    return getEventsTable(clusterData.events);
                    
                case 'nodes':
                    return outputYaml ? (outputJson ? getNodesJson(clusterData.nodes) : getNodesYaml(clusterData.nodes)) : getNodesTable(clusterData.nodes);
                    
                case 'namespaces':
                    return getNamespacesTable();
                    
                case 'persistentvolumes':
                    return getPersistentVolumesTable();
                    
                case 'persistentvolumeclaims':
                    return getPersistentVolumeClaimsTable();
                    
                case 'endpoints':
                    return getEndpointsTable(clusterData);
                    
                case 'crd':
                    return getCRDsTable(clusterData.crds);
                    
                case 'all':
                    return getAllResourcesTable(clusterData);
                    
                default:
                    return `<div class="error-output">Error: the server doesn't have a resource type "${resource}"</div>`;
            }
        }

        function getPodsTable(pods) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">NAME                           READY   STATUS    RESTARTS   AGE</div>`;
            
            if (!pods || !Array.isArray(pods)) {
                table += `<div class="kubectl-row">No resources found</div>`;
                table += `</div>`;
                return table;
            }
            
            pods.forEach(pod => {
                const statusClass = pod.status.toLowerCase() === 'running' ? 'status-running' : 
                                   pod.status.toLowerCase() === 'pending' ? 'status-pending' : 'status-error';
                table += `<div class="kubectl-row">
                    <span class="resource-name">${pod.name}</span>
                    <span>${pod.ready}</span>
                    <span class="${statusClass}">${pod.status}</span>
                    <span>${pod.restarts}</span>
                    <span>${pod.age}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getServicesTable(services) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</div>`;
            
            if (!services || !Array.isArray(services)) {
                table += `<div class="kubectl-row">No resources found</div>`;
                table += `</div>`;
                return table;
            }
            
            services.forEach(service => {
                table += `<div class="kubectl-row">
                    <span class="resource-name">${service.name}</span>
                    <span>${service.type}</span>
                    <span>${service.clusterIp}</span>
                    <span>${service.externalIp}</span>
                    <span>${service.ports}</span>
                    <span>${service.age}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getDeploymentsTable(deployments) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">NAME               READY   UP-TO-DATE   AVAILABLE   AGE</div>`;
            
            if (!deployments || !Array.isArray(deployments)) {
                table += `<div class="kubectl-row">No resources found</div>`;
                table += `</div>`;
                return table;
            }
            
            deployments.forEach(deployment => {
                table += `<div class="kubectl-row">
                    <span class="resource-name">${deployment.name}</span>
                    <span>${deployment.ready}</span>
                    <span>${deployment.upToDate}</span>
                    <span>${deployment.available}</span>
                    <span>${deployment.age}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getReplicaSetsTable(replicasets) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">NAME                          DESIRED   CURRENT   READY   AGE</div>`;
            
            replicasets.forEach(rs => {
                table += `<div class="kubectl-row">
                    <span class="resource-name">${rs.name}</span>
                    <span>${rs.desired}</span>
                    <span>${rs.current}</span>
                    <span>${rs.ready}</span>
                    <span>${rs.age}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getConfigMapsTable(configmaps) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">NAME               DATA   AGE</div>`;
            
            configmaps.forEach(cm => {
                table += `<div class="kubectl-row">
                    <span class="resource-name">${cm.name}</span>
                    <span>${cm.data}</span>
                    <span>${cm.age}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getSecretsTable(secrets) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">NAME                  TYPE                                  DATA   AGE</div>`;
            
            secrets.forEach(secret => {
                table += `<div class="kubectl-row">
                    <span class="resource-name">${secret.name}</span>
                    <span>${secret.type}</span>
                    <span>${secret.data}</span>
                    <span>${secret.age}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getEventsTable(events) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">LAST SEEN   FIRST SEEN   COUNT   NAME                 KIND         SUBOBJECT   TYPE      REASON    SOURCE              MESSAGE</div>`;
            
            events.forEach(event => {
                table += `<div class="kubectl-row" style="grid-template-columns: repeat(10, 1fr); font-size: 0.75em;">
                    <span>${event.lastSeen}</span>
                    <span>${event.firstSeen}</span>
                    <span>${event.count}</span>
                    <span class="resource-name">${event.name}</span>
                    <span>${event.kind}</span>
                    <span>${event.subobject}</span>
                    <span class="status-running">${event.type}</span>
                    <span>${event.reason}</span>
                    <span>${event.source}</span>
                    <span>${event.message}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getNodesTable(nodes) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">NAME           STATUS   ROLES                  AGE   VERSION</div>`;
            
            nodes.forEach(node => {
                table += `<div class="kubectl-row">
                    <span class="resource-name">${node.name}</span>
                    <span class="status-running">${node.status}</span>
                    <span>${node.roles}</span>
                    <span>${node.age}</span>
                    <span>${node.version}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getCRDsTable(crds) {
            let table = `<div class="kubectl-output">
                <div class="kubectl-header">NAME                              CREATED AT</div>`;
            
            crds.forEach(crd => {
                table += `<div class="kubectl-row">
                    <span class="resource-name">${crd.name}</span>
                    <span>${crd.created}</span>
                </div>`;
            });
            
            return table + '</div>';
        }

        function getAllResourcesTable(clusterData) {
            let output = `<div class="kubectl-output">`;
            
            if (clusterData.deployments.length > 0) {
                output += `<div style="margin: 10px 0; color: #4CAF50; font-weight: bold;">NAME                           READY   UP-TO-DATE   AVAILABLE   AGE</div>`;
                output += `<div style="color: #FFB74D;">deployment.apps/webapp-deployment</div>`;
                clusterData.deployments.forEach(d => {
                    output += `<div class="kubectl-row">
                        <span class="resource-name">deployment.apps/${d.name}</span>
                        <span>${d.ready}</span>
                        <span>${d.upToDate}</span>
                        <span>${d.available}</span>
                        <span>${d.age}</span>
                    </div>`;
                });
            }
            
            if (clusterData.services.length > 0) {
                output += `<div style="margin: 15px 0 10px 0; color: #4CAF50; font-weight: bold;">NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</div>`;
                clusterData.services.forEach(s => {
                    output += `<div class="kubectl-row">
                        <span class="resource-name">service/${s.name}</span>
                        <span>${s.type}</span>
                        <span>${s.clusterIp}</span>
                        <span>${s.externalIp}</span>
                        <span>${s.ports}</span>
                        <span>${s.age}</span>
                    </div>`;
                });
            }
            
            if (clusterData.pods.length > 0) {
                output += `<div style="margin: 15px 0 10px 0; color: #4CAF50; font-weight: bold;">NAME                           READY   STATUS    RESTARTS   AGE</div>`;
                clusterData.pods.forEach(p => {
                    const statusClass = p.status.toLowerCase() === 'running' ? 'status-running' : 
                                       p.status.toLowerCase() === 'pending' ? 'status-pending' : 'status-error';
                    output += `<div class="kubectl-row">
                        <span class="resource-name">pod/${p.name}</span>
                        <span>${p.ready}</span>
                        <span class="${statusClass}">${p.status}</span>
                        <span>${p.restarts}</span>
                        <span>${p.age}</span>
                    </div>`;
                });
            }
            
            return output + '</div>';
        }

        function handleDescribeCommand(resource, resourceName, clusterData) {
            if (!resourceName) {
                return `<div class="error-output">Error: You must specify the type of resource to describe.</div>`;
            }
            
            // Normalize resource shortcuts for describe
            const resourceMap = {
                'po': 'pods', 'pod': 'pods',
                'svc': 'services', 'service': 'services',
                'deploy': 'deployments', 'deployment': 'deployments',
                'no': 'nodes', 'node': 'nodes'
            };
            
            const normalizedResource = resourceMap[resource] || resource;
            
            switch (normalizedResource) {
                case 'pods':
                    const pod = clusterData.pods.find(p => p.name.includes(resourceName) || p.name === resourceName);
                    if (!pod) {
                        return `<div class="error-output">Error from server (NotFound): pods "${resourceName}" not found</div>`;
                    }
                    return describePod(pod);
                    
                case 'services':
                    const service = clusterData.services.find(s => s.name === resourceName);
                    if (!service) {
                        return `<div class="error-output">Error from server (NotFound): services "${resourceName}" not found</div>`;
                    }
                    return describeService(service);
                    
                case 'nodes':
                    const node = clusterData.nodes.find(n => n.name === resourceName);
                    if (!node) {
                        return `<div class="error-output">Error from server (NotFound): nodes "${resourceName}" not found</div>`;
                    }
                    return describeNode(node);
                    
                default:
                    return `<div class="error-output">Error: the server doesn't have a resource type "${resource}"</div>`;
            }
        }

        function describeNode(node) {
            return `<div class="kubectl-output" style="color: #e0e0e0;">
Name:               ${node.name}
Roles:              ${node.roles}
Labels:             beta.kubernetes.io/arch=amd64
                    beta.kubernetes.io/os=linux
                    kubernetes.io/arch=amd64
                    kubernetes.io/hostname=${node.name}
                    kubernetes.io/os=linux
Annotations:        node.alpha.kubernetes.io/ttl: 0
CreationTimestamp:  ${new Date(Date.now() - 30*24*60*60*1000).toISOString()}
Taints:             <none>
Unschedulable:      false
Lease:
  HolderIdentity:  ${node.name}
  AcquireTime:     ${new Date(Date.now() - 60000).toISOString()}
  RenewTime:       ${new Date().toISOString()}
Conditions:
  Type             Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message
  ----             ------  -----------------                 ------------------                ------                       -------
  MemoryPressure   False   ${new Date().toISOString()}  ${new Date(Date.now() - 30*24*60*60*1000).toISOString()}  KubeletHasSufficientMemory   kubelet has sufficient memory available
  DiskPressure     False   ${new Date().toISOString()}  ${new Date(Date.now() - 30*24*60*60*1000).toISOString()}  KubeletHasNoDiskPressure     kubelet has no disk pressure
  PIDPressure      False   ${new Date().toISOString()}  ${new Date(Date.now() - 30*24*60*60*1000).toISOString()}  KubeletHasSufficientPID      kubelet has sufficient PID available
  Ready            True    ${new Date().toISOString()}  ${new Date(Date.now() - 30*24*60*60*1000).toISOString()}  KubeletReady                 kubelet is posting ready status
Addresses:
  InternalIP:  192.168.1.10${node.name === 'node-1' ? '1' : node.name === 'node-2' ? '2' : '0'}
  Hostname:    ${node.name}
Capacity:
  cpu:                2
  ephemeral-storage:  20Gi
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             4Gi
  pods:               110
Allocatable:
  cpu:                2
  ephemeral-storage:  18Gi
  hugepages-1Gi:      0
  hugepages-2Mi:      0
  memory:             3.5Gi
  pods:               110
System Info:
  Machine ID:                 abc123def456
  System UUID:                xyz789abc123
  Boot ID:                    boot123
  Kernel Version:             5.4.0-74-generic
  OS Image:                   Ubuntu 20.04.2 LTS
  Operating System:           linux
  Architecture:               amd64
  Container Runtime Version:  containerd://1.6.6
  Kubelet Version:            ${node.version}
  Kube-Proxy Version:         ${node.version}
Non-terminated Pods:          (${node.name.includes('control') ? '10' : node.name === 'node-1' ? '2' : '1'} in total)
  Namespace                   Name                         CPU Requests  CPU Limits  Memory Requests  Memory Limits  AGE
  ---------                   ----                         ------------  ----------  ---------------  -------------  ---
  ${node.name === 'node-1' ? 'default                     webapp-deployment-abc123-pod1   50m (2%)      100m (5%)   64Mi (1%)        128Mi (3%)     2m' : ''}
  ${node.name === 'node-1' ? 'default                     webapp-deployment-abc123-pod3   50m (2%)      100m (5%)   64Mi (1%)        128Mi (3%)     2m' : ''}
  ${node.name === 'node-2' ? 'default                     webapp-deployment-abc123-pod2   50m (2%)      100m (5%)   64Mi (1%)        128Mi (3%)     2m' : ''}
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  Resource           Requests    Limits
  --------           --------    ------
  cpu                ${node.name === 'node-1' ? '100m (5%)' : node.name === 'node-2' ? '50m (2%)' : '500m (25%)'}   ${node.name === 'node-1' ? '200m (10%)' : node.name === 'node-2' ? '100m (5%)' : '1000m (50%)'}
  memory             ${node.name === 'node-1' ? '128Mi (3%)' : node.name === 'node-2' ? '64Mi (1%)' : '2Gi (57%)'}  ${node.name === 'node-1' ? '256Mi (7%)' : node.name === 'node-2' ? '128Mi (3%)' : '4Gi (114%)'}
  ephemeral-storage  0 (0%)      0 (0%)
Events:              <none>
</div>`;
        }

        function describePod(pod) {
            return `<div class="kubectl-output" style="color: #e0e0e0;">
Name:         ${pod.name}
Namespace:    default
Priority:     0
Node:         ${pod.node}
Start Time:   ${new Date(Date.now() - 120000).toISOString()}
Labels:       app=webapp
              pod-template-hash=abc123
Annotations:  <none>
Status:       ${pod.status}
IP:           ${pod.ip}
IPs:
  IP:  ${pod.ip}
Containers:
  webapp:
    Container ID:   containerd://abc123def456
    Image:          nginx:1.21
    Image ID:       docker.io/library/nginx@sha256:abc123
    Port:           80/TCP
    Host Port:      0/TCP
    State:          ${pod.status}
      Started:      ${new Date(Date.now() - 60000).toISOString()}
    Ready:          ${pod.ready === '1/1' ? 'True' : 'False'}
    Restart Count:  ${pod.restarts}
    Limits:
      cpu:     100m
      memory:  128Mi
    Requests:
      cpu:        50m
      memory:     64Mi
    Environment:  <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-xyz (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             ${pod.ready === '1/1' ? 'True' : 'False'}
  ContainersReady   ${pod.ready === '1/1' ? 'True' : 'False'}
  PodScheduled      True
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  2m    default-scheduler  Successfully assigned default/${pod.name} to ${pod.node}
  Normal  Pulled     2m    kubelet            Container image "nginx:1.21" already present on machine
  Normal  Created    2m    kubelet            Created container webapp
  Normal  Started    2m    kubelet            Started container webapp
</div>`;
        }

        function describeService(service) {
            return `<div class="kubectl-output" style="color: #e0e0e0;">
Name:              ${service.name}
Namespace:         default
Labels:            app=webapp
Annotations:       <none>
Selector:          app=webapp
Type:              ${service.type}
IP Family Policy: SingleStack
IP Families:      IPv4
IP:                ${service.clusterIp}
IPs:               ${service.clusterIp}
Port:              http  80/TCP
TargetPort:        80/TCP
Endpoints:         ${service.name === 'webapp-service' ? '10.244.1.10:80,10.244.1.12:80,10.244.2.11:80' : '<none>'}
Session Affinity:  None
Events:            <none>
</div>`;
        }

        function handleLogsCommand(resourceName, clusterData) {
            if (!resourceName) {
                return `<div class="error-output">Error: You must specify a resource name.</div>`;
            }
            
            const pod = clusterData.pods.find(p => p.name.includes(resourceName) || p.name === resourceName);
            if (!pod) {
                return `<div class="error-output">Error from server (NotFound): pods "${resourceName}" not found</div>`;
            }
            
            if (pod.status !== 'Running') {
                return `<div class="error-output">Error: container is not running (${pod.status})</div>`;
            }
            
            return `<div class="kubectl-output" style="color: #81C784; font-family: monospace;">
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration  
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2024/01/30 12:34:56 [notice] 1#1: using the "epoll" event method
2024/01/30 12:34:56 [notice] 1#1: nginx/1.21.6
2024/01/30 12:34:56 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6)
2024/01/30 12:34:56 [notice] 1#1: OS: Linux 5.4.0-74-generic
2024/01/30 12:34:56 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2024/01/30 12:34:56 [notice] 1#1: start worker processes
2024/01/30 12:34:56 [notice] 1#1: start worker process 32
2024/01/30 12:35:01 [info] 32#32: *1 client connected from 10.244.0.1
</div>`;
        }

        function handleApiResourcesCommand() {
            return `<div class="kubectl-output">
<div class="kubectl-header">NAME                              SHORTNAMES   APIVERSION                        NAMESPACED   KIND</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">bindings</span>
    <span></span>
    <span>v1</span>
    <span>true</span>
    <span>Binding</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">componentstatuses</span>
    <span>cs</span>
    <span>v1</span>
    <span>false</span>
    <span>ComponentStatus</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">configmaps</span>
    <span>cm</span>
    <span>v1</span>
    <span>true</span>
    <span>ConfigMap</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">endpoints</span>
    <span>ep</span>
    <span>v1</span>
    <span>true</span>
    <span>Endpoints</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">events</span>
    <span>ev</span>
    <span>v1</span>
    <span>true</span>
    <span>Event</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">limitranges</span>
    <span>limits</span>
    <span>v1</span>
    <span>true</span>
    <span>LimitRange</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">namespaces</span>
    <span>ns</span>
    <span>v1</span>
    <span>false</span>
    <span>Namespace</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">nodes</span>
    <span>no</span>
    <span>v1</span>
    <span>false</span>
    <span>Node</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">persistentvolumeclaims</span>
    <span>pvc</span>
    <span>v1</span>
    <span>true</span>
    <span>PersistentVolumeClaim</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">persistentvolumes</span>
    <span>pv</span>
    <span>v1</span>
    <span>false</span>
    <span>PersistentVolume</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">pods</span>
    <span>po</span>
    <span>v1</span>
    <span>true</span>
    <span>Pod</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">secrets</span>
    <span></span>
    <span>v1</span>
    <span>true</span>
    <span>Secret</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">services</span>
    <span>svc</span>
    <span>v1</span>
    <span>true</span>
    <span>Service</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">deployments</span>
    <span>deploy</span>
    <span>apps/v1</span>
    <span>true</span>
    <span>Deployment</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">replicasets</span>
    <span>rs</span>
    <span>apps/v1</span>
    <span>true</span>
    <span>ReplicaSet</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">ciliumidentities</span> 
    <span></span>
    <span>cilium.io/v2</span>
    <span>false</span>
    <span>CiliumIdentity</span>
</div>
<div class="kubectl-row" style="grid-template-columns: 2fr 1fr 2fr 1fr 2fr; font-size: 0.8em;">
    <span class="resource-name">ciliumnetworkpolicies</span>
    <span>cnp</span>
    <span>cilium.io/v2</span>
    <span>true</span>
    <span>CiliumNetworkPolicy</span>
</div>
</div>`;
        }

        function getSinglePodTable(pod) {
            const statusClass = pod.status.toLowerCase() === 'running' ? 'status-running' : 
                               pod.status.toLowerCase() === 'pending' ? 'status-pending' : 'status-error';
            return `<div class="kubectl-output">
                <div class="kubectl-header">NAME                           READY   STATUS    RESTARTS   AGE</div>
                <div class="kubectl-row">
                    <span class="resource-name">${pod.name}</span>
                    <span>${pod.ready}</span>
                    <span class="${statusClass}">${pod.status}</span>
                    <span>${pod.restarts}</span>
                    <span>${pod.age}</span>
                </div>
            </div>`;
        }

        function getNamespacesTable() {
            return `<div class="kubectl-output">
                <div class="kubectl-header">NAME              STATUS   AGE</div>
                <div class="kubectl-row">
                    <span class="resource-name">default</span>
                    <span class="status-running">Active</span>
                    <span>30d</span>
                </div>
                <div class="kubectl-row">
                    <span class="resource-name">kube-system</span>
                    <span class="status-running">Active</span>
                    <span>30d</span>
                </div>
                <div class="kubectl-row">
                    <span class="resource-name">kube-public</span>
                    <span class="status-running">Active</span>
                    <span>30d</span>
                </div>
            </div>`;
        }

        function getPersistentVolumesTable() {
            return `<div class="kubectl-output">
                <div class="kubectl-header">NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</div>
                <div style="color: #888; padding: 10px;">No resources found</div>
            </div>`;
        }

        function getPersistentVolumeClaimsTable() {
            return `<div class="kubectl-output">
                <div class="kubectl-header">NAME   STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</div>
                <div style="color: #888; padding: 10px;">No resources found in default namespace.</div>
            </div>`;
        }

        function getEndpointsTable(clusterData) {
            return `<div class="kubectl-output">
                <div class="kubectl-header">NAME             ENDPOINTS                                      AGE</div>
                <div class="kubectl-row">
                    <span class="resource-name">kubernetes</span>
                    <span>192.168.1.100:6443</span>
                    <span>30d</span>
                </div>
                <div class="kubectl-row">
                    <span class="resource-name">webapp-service</span>
                    <span>${currentStep >= 9 ? '10.244.1.10:80,10.244.1.12:80,10.244.2.11:80' : '<none>'}</span>
                    <span>${currentStep >= 9 ? '2m' : '30s'}</span>
                </div>
            </div>`;
        }

        // Main kubectl command processor
        function executeKubectlCommand(command) {
            const parts = command.toLowerCase().split(/\s+/);
            
            if (parts.length === 0) {
                return '<div class="error-output">Error: empty command</div>';
            }

            // Remove 'kubectl' prefix if present
            if (parts[0] === 'kubectl') {
                parts.shift();
            }

            if (parts.length === 0 || parts[0] === 'help' || parts[0] === '-h' || parts[0] === '--help') {
                return getHelpOutput();
            }

            const action = parts[0];
            
            switch (action) {
                case 'get':
                    return handleGetCommand(parts.slice(1));
                case 'describe':
                    return handleDescribeCommand(parts.slice(1));
                case 'logs':
                    return handleLogsCommand(parts.slice(1));
                case 'api-resources':
                    return getApiResourcesOutput();
                case 'version':
                    return getVersionOutput();
                case 'cluster-info':
                    return getClusterInfoOutput();
                case 'config':
                    return handleConfigCommand(parts.slice(1));
                default:
                    return `<div class="error-output">Error: unknown command "${action}". Try "help" for available commands.</div>`;
            }
        }

        function handleGetCommand(parts) {
            if (parts.length === 0) {
                return '<div class="error-output">Error: You must specify the type of resource to get.</div>';
            }

            const resource = parts[0];
            const options = parts.slice(1);
            let outputJson = options.includes('-o') && options.includes('json');
            let outputYaml = options.includes('-o') && options.includes('yaml');
            let wide = options.includes('-o') && options.includes('wide');

            // Map common shortcuts
            const resourceMap = {
                'po': 'pods',
                'pods': 'pods',
                'svc': 'services', 
                'services': 'services',
                'deploy': 'deployments',
                'deployments': 'deployments',
                'rs': 'replicasets',
                'replicasets': 'replicasets',
                'cm': 'configmaps',
                'configmaps': 'configmaps',
                'secrets': 'secrets',
                'ns': 'namespaces',
                'namespaces': 'namespaces',
                'nodes': 'nodes',
                'pv': 'persistentvolumes',
                'persistentvolumes': 'persistentvolumes',
                'pvc': 'persistentvolumeclaims',
                'persistentvolumeclaims': 'persistentvolumeclaims',
                'endpoints': 'endpoints',
                'ep': 'endpoints',
                'events': 'events',
                'ingress': 'ingress',
                'ing': 'ingress'
            };

            const mappedResource = resourceMap[resource] || resource;

            switch (mappedResource) {
                case 'pods':
                    return getPodsTable(outputJson, outputYaml, wide);
                case 'services':
                    return getServicesTable();
                case 'deployments':
                    return getDeploymentsTable();
                case 'replicasets':
                    return getReplicaSetsTable();
                case 'configmaps':
                    return getConfigMapsTable();
                case 'secrets':
                    return getSecretsTable();
                case 'namespaces':
                    return getNamespacesTable();
                case 'nodes':
                    return getNodesTable();
                case 'persistentvolumes':
                    return getPersistentVolumesTable();
                case 'persistentvolumeclaims':
                    return getPersistentVolumeClaimsTable();
                case 'endpoints':
                    return getEndpointsTable();
                default:
                    return `<div class="error-output">Error: the server doesn't have a resource type "${resource}"</div>`;
            }
        }

        function handleDescribeCommand(parts) {
            if (parts.length === 0) {
                return '<div class="error-output">Error: You must specify the type of resource to describe.</div>';
            }

            const resource = parts[0];
            const name = parts[1];

            if (resource === 'pod' || resource === 'pods' || resource === 'po') {
                if (!name) {
                    return '<div class="error-output">Error: You must specify pod name</div>';
                }
                const pods = getClusterPods();
                const pod = pods.find(p => p.name === name);
                if (!pod) {
                    return `<div class="error-output">Error: pods "${name}" not found</div>`;
                }
                return getPodDescription(pod);
            }

            return `<div class="error-output">Error: describe ${resource} not implemented yet</div>`;
        }

        function handleLogsCommand(parts) {
            if (parts.length === 0) {
                return '<div class="error-output">Error: You must specify pod name</div>';
            }

            const podName = parts[0];
            const pods = getClusterPods();
            const pod = pods.find(p => p.name === podName);
            
            if (!pod) {
                return `<div class="error-output">Error: pods "${podName}" not found</div>`;
            }

            return getPodLogs(pod);
        }

        function handleConfigCommand(parts) {
            if (parts.length === 0 || parts[0] === 'view') {
                return getKubeconfigOutput();
            }
            return '<div class="error-output">Error: config subcommand not supported</div>';
        }

        function getHelpOutput() {
            return `<div class="kubectl-output">
<div style="color: #4CAF50; font-weight: bold; margin-bottom: 10px;">🔧 kubectl - Kubernetes command line interface</div>

<div style="color: #FFC107; font-weight: bold;">Basic Commands:</div>
<div style="margin-left: 15px; margin-bottom: 10px;">
  get         Display one or many resources
  describe    Show detailed information about a resource
  logs        Print container logs
  api-resources    Print supported API resources
  version     Print client and server version
  cluster-info Display cluster info
  config      Modify kubeconfig files
</div>

<div style="color: #FFC107; font-weight: bold;">Resource shortcuts:</div>
<div style="margin-left: 15px; font-family: monospace; font-size: 12px;">
  po = pods              svc = services         deploy = deployments
  rs = replicasets       cm = configmaps        ns = namespaces
  pv = persistentvolumes pvc = persistentvolumeclaims
  ep = endpoints         ing = ingress
</div>

<div style="color: #FFC107; font-weight: bold; margin-top: 10px;">Examples:</div>
<div style="margin-left: 15px; font-family: monospace; font-size: 12px; color: #ccc;">
  kubectl get pods
  kubectl get svc
  kubectl describe pod webapp-deployment-abc123
  kubectl logs webapp-deployment-abc123
  kubectl get pods -o yaml
</div>
            </div>`;
        }

        function getVersionOutput() {
            return `<div class="kubectl-output">
Client Version: version.Info{Major:"1", Minor:"28", GitVersion:"v1.28.2"}
Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3
Server Version: version.Info{Major:"1", Minor:"28", GitVersion:"v1.28.2"}
            </div>`;
        }

        function getClusterInfoOutput() {
            return `<div class="kubectl-output">
<div style="color: #4CAF50;">Kubernetes control plane</div> is running at <span style="color: #2196F3;">https://192.168.1.100:6443</span>
<div style="color: #4CAF50;">CoreDNS</div> is running at <span style="color: #2196F3;">https://192.168.1.100:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
            </div>`;
        }

        function getKubeconfigOutput() {
            return `<div class="yaml-output">apiVersion: v1
clusters:
- cluster:
    server: https://192.168.1.100:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
users:
- name: kubernetes-admin</div>`;
        }

        function getPodDescription(pod) {
            return `<div class="kubectl-output">
Name:         ${pod.name}
Namespace:    default
Priority:     0
Node:         ${pod.node}
Start Time:   ${new Date(Date.now() - 120000).toISOString()}
Labels:       app=webapp
              pod-template-hash=abc123
Status:       ${pod.status}
IP:           ${pod.ip}
Controlled By:  ReplicaSet/webapp-deployment-abc123

Containers:
  webapp:
    Container ID:   containerd://abc123def456
    Image:          nginx:1.21
    Image ID:       sha256:f6d0b4767a6c
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      ${new Date(Date.now() - 60000).toISOString()}
    Ready:          ${pod.ready === '1/1' ? 'True' : 'False'}
    Restart Count:  ${pod.restarts}
    Limits:
      cpu:     100m
      memory:  128Mi
    Requests:
      cpu:      50m
      memory:   64Mi
    Environment:  <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-123 (ro)

Conditions:
  Type              Status
  Initialized       True
  Ready             ${pod.ready === '1/1' ? 'True' : 'False'}
  ContainersReady   ${pod.ready === '1/1' ? 'True' : 'False'}
  PodScheduled      True

Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  2m    default-scheduler  Successfully assigned default/${pod.name} to ${pod.node}
  Normal  Pulling    2m    kubelet            Pulling image "nginx:1.21"
  Normal  Pulled     2m    kubelet            Successfully pulled image "nginx:1.21"
  Normal  Created    2m    kubelet            Created container webapp
  Normal  Started    2m    kubelet            Started container webapp
            </div>`;
        }

        function getPodLogs(pod) {
            const logs = [
                '2024/01/15 10:30:22 [notice] 1#1: using the "epoll" event method',
                '2024/01/15 10:30:22 [notice] 1#1: nginx/1.21.6',
                '2024/01/15 10:30:22 [notice] 1#1: OS: Linux 5.4.0-74-generic',
                '2024/01/15 10:30:22 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576',
                '2024/01/15 10:30:22 [notice] 1#1: start worker processes',
                '2024/01/15 10:30:22 [notice] 1#1: start worker process 28',
                '2024/01/15 10:30:22 [notice] 1#1: start worker process 29',
                `${new Date().toISOString()} - ${pod.name} - Container started successfully`,
                `${new Date().toISOString()} - ${pod.name} - Ready to accept connections on port 80`
            ];
            
            return `<div class="kubectl-output" style="font-family: monospace; font-size: 12px; line-height: 1.3;">
${logs.map(log => `<div style="margin-bottom: 2px;">${log}</div>`).join('')}
            </div>`;
        }

        function getPodYaml(pod) {
            return `<div class="yaml-output">apiVersion: v1
kind: Pod
metadata:
  name: ${pod.name}
  namespace: default
  labels:
    app: webapp
    pod-template-hash: abc123
spec:
  containers:
  - name: webapp
    image: nginx:1.21
    ports:
    - containerPort: 80
      protocol: TCP
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi
  restartPolicy: Always
  nodeName: ${pod.node}
status:
  phase: ${pod.status}
  podIP: ${pod.ip}
  conditions:
  - type: Ready
    status: "${pod.ready === '1/1' ? 'True' : 'False'}"
  containerStatuses:
  - name: webapp
    ready: ${pod.ready === '1/1' ? 'true' : 'false'}
    restartCount: ${pod.restarts}
    image: nginx:1.21
    state:
      running:
        startedAt: "${new Date(Date.now() - 60000).toISOString()}"</div>`;
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            updateButtons();
            console.log('Initialization complete');
        });
    </script>
</body>
</html>